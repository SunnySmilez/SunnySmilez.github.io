<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[狂奔的菜鸟]]></title>
  <subtitle><![CDATA[当你的实力支撑不起你的野心的时候，静下心来好好学习吧！]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://www.cxyteam.com/"/>
  <updated>2018-12-27T14:20:43.326Z</updated>
  <id>http://www.cxyteam.com/</id>
  
  <author>
    <name><![CDATA[狂奔的菜鸟]]></name>
    <email><![CDATA[phpchengxuyuan@sina.com]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[使用kubeadm安装k8s]]></title>
    <link href="http://www.cxyteam.com/2018/12/20/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85k8s/"/>
    <id>http://www.cxyteam.com/2018/12/20/使用kubeadm安装k8s/</id>
    <published>2018-12-20T15:50:52.000Z</published>
    <updated>2018-12-27T14:20:43.326Z</updated>
    <content type="html"><![CDATA[<p>在安装前，最好事先准备好一个干净的环境，不然会浪费更多的时间，尤其是之前折腾过docker的一些环境。我因为之前安装过一个低版本的docker-ce，之后用yum进行升级之后，再去安装kubeadm，kubectl出现各种问题，最后放弃解决了。</p>
<h3 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h3><ol>
<li>CentOS 7.6</li>
<li>Docker 18.06.1-ce</li>
<li>Kubernetes v1.13.1</li>
<li>virtualBox 5.0.38</li>
</ol>
<h3 id="机器"><a href="#机器" class="headerlink" title="机器"></a>机器</h3><ol>
<li>master：hostname：master.localdomain ip: 10.17.3.110</li>
</ol>
<h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><ol>
<li>设置双核<br>注：k8s要求</li>
</ol>
<p>关闭虚拟机之后，设置-&gt;系统-&gt;处理器-&gt;设置为2</p>
<ol>
<li>关闭防火墙<br>关闭防火墙</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl stop firewalld</div><div class="line">systemctl disable firewalld</div></pre></td></tr></table></figure>
<p>禁用SELINUX</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setenforce 0</div><div class="line">sed -i &apos;s/SELINUX=permissive/SELINUX=disabled/&apos; /etc/sysconfig/selinux</div></pre></td></tr></table></figure>
<ol>
<li>关闭swap分区<br>注：k8s要求</li>
</ol>
<p>临时生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">swapoff -a</div></pre></td></tr></table></figure>
<p>永久生效</p>
<p>在文件/etc/fstab中，删除”swap”这一行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/dev/mapper/cl-swap     swap                    swap    defaults        0 0</div></pre></td></tr></table></figure></p>
<ol>
<li>修改hostname<br>注： kubernetes 是根据 hostname 来标示各节点的</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">echo &quot;master.localdomain&quot; &gt; /etc/hostname</div><div class="line">echo &quot;10.17.3.110   master.localdomain&quot; &gt;&gt; /etc/hosts</div><div class="line">sysctl kernel.hostname=master.localdomain</div></pre></td></tr></table></figure>
<h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><ol>
<li>添加docker镜像</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/docker.repo</div><div class="line">[dockerrepo]</div><div class="line">name=Docker Repository</div><div class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://yum.dockerproject.org/gpg</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ol>
<li>安装依赖，添加镜像</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</div><div class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</div></pre></td></tr></table></figure>
<ol>
<li>查看最新的docker版本</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum makecache fast</div><div class="line">yum list docker-ce.x86_64  --showduplicates |sort -r</div></pre></td></tr></table></figure>
<ol>
<li>安装18.06.1<br>注：Kubernetes 1.12已经针对Docker的1.11.1, 1.12.1, 1.13.1, 17.03, 17.06, 17.09, 18.06等版本做了验证，需要注意Kubernetes 1.12最低支持的Docker版本是1.11.1</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install -y --setopt=obsoletes=0 \</div><div class="line">  docker-ce-18.06.1.ce-3.el7</div></pre></td></tr></table></figure>
<p>启动docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start docker</div><div class="line">systemctl enable docker</div></pre></td></tr></table></figure>
<p>验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker -v</div></pre></td></tr></table></figure>
<p>确认一下iptables filter表中FOWARD链的默认策略(pllicy)为ACCEPT<br>注：Docker从1.13版本开始调整了默认的防火墙规则，禁用了iptables filter表中FOWARD链，这样会引起Kubernetes集群中跨Node的Pod无法通信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -nvL</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Chain INPUT (policy ACCEPT 103 packets, 13250 bytes)</div><div class="line"> pkts bytes target     prot opt in     out     source               destination</div><div class="line">22366   18M KUBE-EXTERNAL-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes externally-visible service portals */</div><div class="line"> 817K  176M KUBE-FIREWALL  all  --  *      *       0.0.0.0/0            0.0.0.0/0</div><div class="line"></div><div class="line"># 在这里，注意看</div><div class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</div><div class="line"> pkts bytes target     prot opt in     out     source               destination</div><div class="line">    0     0 KUBE-FORWARD  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* kubernetes forwarding rules */</div><div class="line">    0     0 DOCKER-USER  all  --  *      *       0.0.0.0/0            0.0.0.0/0</div><div class="line">    0     0 DOCKER-ISOLATION-STAGE-1  all  --  *      *       0.0.0.0/0            0.0.0.0/0</div><div class="line">    0     0 ACCEPT     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</div><div class="line">    0     0 DOCKER     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0</div><div class="line">    0     0 ACCEPT     all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0</div><div class="line">    0     0 ACCEPT     all  --  docker0 docker0  0.0.0.0/0            0.0.0.0/0</div><div class="line"></div><div class="line">Chain OUTPUT (policy ACCEPT 128 packets, 19058 bytes)</div><div class="line"> pkts bytes target     prot opt in     out     source               destination</div><div class="line">14698  884K KUBE-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes service portals */</div><div class="line"> 809K  159M KUBE-FIREWALL  all  --  *      *       0.0.0.0/0            0.0.0.0/0</div></pre></td></tr></table></figure>
<h3 id="安装kubelet-kubeadm-kubectl"><a href="#安装kubelet-kubeadm-kubectl" class="headerlink" title="安装kubelet,kubeadm,kubectl"></a>安装kubelet,kubeadm,kubectl</h3><ol>
<li>添加国内kubelet镜像</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</div><div class="line">[kubernetes]</div><div class="line">name=Kubernetes</div><div class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">repo_gpgcheck=1</div><div class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ol>
<li>修改网络开启桥接网络支持，只针对（RHEL/CentOS 7）系统<br>注：配置转发相关参数，否则可能会出错</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</div><div class="line">net.bridge.bridge-nf-call-ip6tables = 1</div><div class="line">net.bridge.bridge-nf-call-iptables = 1</div><div class="line">net.ipv4.ip_forward = 1</div><div class="line">vm.swappiness=0</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>执行命令使其生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">modprobe br_netfilter</div><div class="line">sysctl -p /etc/sysctl.d/k8s.conf</div></pre></td></tr></table></figure>
<ol>
<li>安装</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y kubelet kubeadm kubectl ipvsadm</div></pre></td></tr></table></figure>
<ol>
<li>配置kubelet和docker的cgroups一致</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DOCKER_CGROUPS=$(docker info | grep &apos;Cgroup&apos; | cut -d&apos; &apos; -f3)</div><div class="line">echo $DOCKER_CGROUPS</div><div class="line">cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF</div><div class="line">KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=$DOCKER_CGROUPS --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1&quot;</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ol>
<li>启动<br>注：这个时候查看版本或者kubectl都会报错”The connection to the server localhost:8080 was refused<br>“，不要担心，接着走后面的流程</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div><div class="line">systemctl enable kubelet &amp;&amp; systemctl restart kubelet</div></pre></td></tr></table></figure>
<h3 id="启动master"><a href="#启动master" class="headerlink" title="启动master"></a>启动master</h3><ol>
<li>kubeadm初始化<br>注：见到这个文字就表示成功了”Your Kubernetes master has initialized successfully!”<br>如果失败了，执行kubeadm reset删除之前的一些文件，再进行kubeadm init</li>
</ol>
<p>因为我们选择flannel作为Pod网络插件，所以上面的命令指定–pod-network-cidr=10.244.0.0/16</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm init --kubernetes-version=v1.13.1 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.17.3.110</div></pre></td></tr></table></figure>
<ol>
<li>按照successfully提示执行后续命令</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir -p $HOME/.kube</div><div class="line">cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</div><div class="line">chown $(id -u):$(id -g) $HOME/.kube/config</div></pre></td></tr></table></figure>
<ol>
<li>验证</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl version</div><div class="line">kubectl get nodes</div></pre></td></tr></table></figure>
<h3 id="添加flannel网络"><a href="#添加flannel网络" class="headerlink" title="添加flannel网络"></a>添加flannel网络</h3><ol>
<li><p>下载yml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</div></pre></td></tr></table></figure>
</li>
<li><p>添加iface启动参数<br>注：有多个网卡的话，需要在kube-flannel.yml中使用–iface参数指定集群主机内网网卡的名称，否则可能会出现dns无法解析。比如我是用的virtualBox，存在多个网卡，使用的是enp0s3网卡，所以修改如下（因为yaml文件创建5个针对不同平台的DaemonSet，所以最好是都改了）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attr">containers:</span></div><div class="line"><span class="attr">  - name:</span> kube-flannel</div><div class="line"><span class="attr">    image:</span> quay.io/coreos/flannel:v0<span class="number">.10</span><span class="number">.0</span>-amd64</div><div class="line"><span class="attr">    command:</span></div><div class="line"><span class="bullet">    -</span> /opt/bin/flanneld</div><div class="line"><span class="attr">    args:</span></div><div class="line"><span class="bullet">    -</span> --ip-masq</div><div class="line"><span class="bullet">    -</span> --kube-subnet-mgr</div><div class="line"><span class="bullet">    -</span> --iface=enp0s3</div></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f  kube-flannel.yml</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="添加node节点"><a href="#添加node节点" class="headerlink" title="添加node节点"></a>添加node节点</h3><ol>
<li>添加节点<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm join 10.17.3.110:6443 --token vh535w.c4abw601jzuxt7su --discovery-token-ca-cert-hash sha256:25bf91dd3e69f0bfe1f5600f0ac56633ed5c58ca89d906b6cad611eb01e04356</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="测试网络"><a href="#测试网络" class="headerlink" title="测试网络"></a>测试网络</h3><ol>
<li><p>创建测试development</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl run curl --image=radial/busyboxplus:curl -it</div></pre></td></tr></table></figure>
</li>
<li><p>在容器中执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nslookup kubernetes.default</div></pre></td></tr></table></figure>
</li>
</ol>
<p>输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Server:    10.96.0.10</div><div class="line">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</div><div class="line"></div><div class="line">Name:      kubernetes.default</div><div class="line">Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local</div><div class="line"></div><div class="line">kubectl delete deployment curl</div></pre></td></tr></table></figure>
<ol>
<li>删除<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl delete deployment curl</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证集群"><a href="#验证集群" class="headerlink" title="验证集群"></a>验证集群</h3><ol>
<li>查看集群状态<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get cs</div></pre></td></tr></table></figure>
</li>
</ol>
<p>输出结果如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NAME                 STATUS    MESSAGE              ERROR</div><div class="line">scheduler            Healthy   ok</div><div class="line">controller-manager   Healthy   ok</div><div class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>查看node状态<br>注：刚执行完添加节点命令后，可以稍等下再去查看<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get nodes</div></pre></td></tr></table></figure>
</li>
</ol>
<p>输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NAME                 STATUS   ROLES    AGE     VERSION</div><div class="line">kubeadm-node1        Ready    &lt;none&gt;   8m36s   v1.13.1</div><div class="line">master.localdomain   Ready    master   15m     v1.13.1</div></pre></td></tr></table></figure></p>
<ol>
<li>查看pod状态<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl -n kube-system get pod --all-namespaces</div></pre></td></tr></table></figure>
</li>
</ol>
<p>输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE</div><div class="line">kube-system   coredns-86c58d9df4-tjcdl                     1/1     Running   0          12m</div><div class="line">kube-system   coredns-86c58d9df4-vzf95                     1/1     Running   0          12m</div><div class="line">kube-system   etcd-master.localdomain                      1/1     Running   0          12m</div><div class="line">kube-system   kube-apiserver-master.localdomain            1/1     Running   0          12m</div><div class="line">kube-system   kube-controller-manager-master.localdomain   1/1     Running   0          12m</div><div class="line">kube-system   kube-flannel-ds-amd64-6zvwg                  1/1     Running   5          6m2s</div><div class="line">kube-system   kube-flannel-ds-amd64-q62rd                  1/1     Running   0          9m47s</div><div class="line">kube-system   kube-proxy-8dlpf                             1/1     Running   0          12m</div><div class="line">kube-system   kube-proxy-xcwhj                             1/1     Running   0          6m2s</div><div class="line">kube-system   kube-scheduler-master.localdomain            1/1     Running   0          12m</div></pre></td></tr></table></figure></p>
<h3 id="其他注意项"><a href="#其他注意项" class="headerlink" title="其他注意项"></a>其他注意项</h3><ol>
<li><p>初始化master节点（kubeadm init）失败后，使用”kubeadm reset”回到初始化之前的状态，再次进行初始化</p>
</li>
<li><p>master初始化成功后，没有记录node加入集群的命令（kubectl join）<br>简单方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm token create --print-join-command</div></pre></td></tr></table></figure>
</li>
</ol>
<p>第二种方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">token=$(kubeadm token generate)</div><div class="line">kubeadm token create $token --print-join-command --ttl=0</div></pre></td></tr></table></figure></p>
<p>token 是使用指令 kubeadm token generate 生成的，执行过程如有异常，用命令kubeadm reset 初始化后重试，生成的 token 有效时间为 24 小时，超过 24 小时后需要重新使用命令 kubeadm token create 创建新的 token。<br>discovery-token-ca-cert-hash 的值可以使用命令查看，命令：openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed ‘s/^.* //‘</p>
<ol>
<li>查看kube-system日志</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl -n kube-system logs kube-controller-manager-master.localdomain</div></pre></td></tr></table></figure>
<ol>
<li>重新部署node</li>
</ol>
<p>在集群中删除node信息（在master执行）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl drain &lt;node_name&gt; --delete-local-data --force --ignore-daemonsets</div><div class="line">kubectl delete node &lt;node_name&gt;</div></pre></td></tr></table></figure></p>
<p>node删除flannel网段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">kubeadm reset</div><div class="line">ifconfig cni0 down</div><div class="line">ip link delete cni0</div><div class="line">ifconfig flannel.1 down</div><div class="line">ip link delete flannel.1</div><div class="line">rm -rf /var/lib/cni/</div></pre></td></tr></table></figure></p>
<ol>
<li>节点状态不正确<br>查看日志</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">journalctl -u kubelet</div></pre></td></tr></table></figure>
<p>查看kubelet状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl status kubelet</div></pre></td></tr></table></figure></p>
<ol>
<li>其他节点管理集群<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scp root@&lt;master_ip&gt;:/etc/kubernetes/admin.conf .</div><div class="line">kubectl --kubeconfig ./admin.conf get nodes</div></pre></td></tr></table></figure>
</li>
</ol>
<p>注意：<br>当使用systemctl start kubelet失败的时候，可以使用”systemctl status kubelet -l”，”journalctl -xeu kubelet<br>“查看详细信息</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://github.com/youngperson/study-100/wiki/kubeadm%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4" title="亮亮的k8s搭建" target="_blank" rel="external">亮亮的k8s搭建</a><br><a href="https://github.com/HikoQiu/kubeadm-install-k8s" title="kubeadm-install-k8s" target="_blank" rel="external">kubeadm-install-k8s</a><br><a href="https://www.kubernetes.org.cn/4256.html" title="centos7使用kubeadm安装kubernetes 1.11版本多主高可用" target="_blank" rel="external">centos7使用kubeadm安装kubernetes 1.11版本多主高可用</a><br><a href="https://www.kubernetes.org.cn/4619.html" title="使用kubeadm安装Kubernetes 1.12" target="_blank" rel="external">使用kubeadm安装Kubernetes 1.12</a><br><a href="https://blog.csdn.net/aixiaoyang168/article/details/78411511" title="国内使用 kubeadm 在 Centos 7 搭建 Kubernetes 集群" target="_blank" rel="external">国内使用 kubeadm 在 Centos 7 搭建 Kubernetes 集群</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>在安装前，最好事先准备好一个干净的环境，不然会浪费更多的时间，尤其是之前折腾过docker的一些环境。我因为之前安装过一个低版本的docker-ce，之后用yum进行升级之后，再去安装kubeadm，kubectl出现各种问题，最后放弃解决了。</p>
<h3 id="搭建]]>
    </summary>
    
      <category term="k8s" scheme="http://www.cxyteam.com/tags/k8s/"/>
    
      <category term="k8s" scheme="http://www.cxyteam.com/categories/k8s/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[yaml的使用]]></title>
    <link href="http://www.cxyteam.com/2018/12/09/yaml%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.cxyteam.com/2018/12/09/yaml的使用/</id>
    <published>2018-12-09T09:15:04.000Z</published>
    <updated>2018-12-09T10:08:53.190Z</updated>
    <content type="html"><![CDATA[<p>Yaml是专门用来编写配置文件的，非常的简洁强大</p>
<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><p>大小写敏感</p>
<p>使用缩进表示层级关系</p>
<p>缩进时不允许使用Tab键，只允许使用空格。</p>
<p>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</p>
<p>使用#表示注释，从这个字符一直到行尾，都会被解析器忽略</p>
<p>yaml一共三种结构</p>
<ol>
<li>Lists（数组）</li>
<li>Maps（对象）</li>
<li>scalars（存量）</li>
</ol>
<h1 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h1><p>一组连线开头的行，构成一个数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">command</div><div class="line">    - &apos;sh&apos;</div><div class="line">    - &apos;cmd&apos;</div></pre></td></tr></table></figure></p>
<p>用json表示则是<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"command"</span>:['sh', 'cmd']</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h1><p>一组键值对，使用冒号结构表示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kind:Pod</div></pre></td></tr></table></figure></p>
<p>使用json表示则是<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"kind"</span>:<span class="string">"pod"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="组合方式"><a href="#组合方式" class="headerlink" title="组合方式"></a>组合方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">spec:</div><div class="line">  restartPolicy: Always</div><div class="line">  nodeSelector:</div><div class="line">    zone: node1</div><div class="line">  containers:</div><div class="line">  - name: web01-pod</div><div class="line">    image: sunnysmilez/php</div><div class="line">    imagePullPolicy: Never</div></pre></td></tr></table></figure>
<p>使用json表示<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"spec"</span> : &#123;</div><div class="line">    <span class="attr">"restartPolicy"</span>:<span class="string">"Always"</span>,</div><div class="line">    <span class="attr">"nodeSelector"</span>:&#123;</div><div class="line">      <span class="attr">"zone"</span>:<span class="string">"node1"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"containers"</span>:[&#123;</div><div class="line">        <span class="attr">"name"</span>:<span class="string">"web01-pod"</span>,</div><div class="line">        <span class="attr">"image"</span>:<span class="string">"sunnysmilez/php"</span>,</div><div class="line">        <span class="attr">"imagePullPolicy"</span>:<span class="string">"Never"</span></div><div class="line">    &#125;]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Yaml是专门用来编写配置文件的，非常的简洁强大</p>
<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><p>大小写敏感</p>
<p>使用缩进表示层级关系</p>
<p]]>
    </summary>
    
      <category term="Other" scheme="http://www.cxyteam.com/tags/Other/"/>
    
      <category term="Other" scheme="http://www.cxyteam.com/categories/Other/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[k8s使用yaml搭建lnmp]]></title>
    <link href="http://www.cxyteam.com/2018/12/07/k8s%E4%BD%BF%E7%94%A8yaml%E6%90%AD%E5%BB%BAlnmp/"/>
    <id>http://www.cxyteam.com/2018/12/07/k8s使用yaml搭建lnmp/</id>
    <published>2018-12-07T05:31:44.000Z</published>
    <updated>2018-12-09T08:24:19.219Z</updated>
    <content type="html"><![CDATA[<h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h1><p>「mac+minikube」</p>
<ol>
<li>mac10.13.6</li>
<li>minikube version:v0.30.0</li>
<li>kubectl version</li>
</ol>
<pre><code>Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;10&quot;, GitVersion:&quot;v1.10.3&quot;, GitCommit:&quot;2bba0127d85d5a46ab4b778548be28623b32d0b0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T09:17:39Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;darwin/amd64&quot;}
</code></pre><h1 id="搭建架构图"><a href="#搭建架构图" class="headerlink" title="搭建架构图"></a>搭建架构图</h1><p><a href="https://github.com/SunnySmilez/k8s/tree/master/lnmp" target="_blank" rel="external">项目搭建源码</a></p>
<p><img src="/img/k8s/lnmp.png" alt="k8s搭建lnmp服务架构图" title="lnmp"></p>
<p>在搭建之前先了解几个知识点：</p>
<ul>
<li>pod节点通过service暴露端口提供外部访问<br>可以设置type=”NodePort”，访问：<a href="http://nodeip:nodePort" target="_blank" rel="external">http://nodeip:nodePort</a></li>
</ul>
<p>「nodeip可以使用minikube ip获得；nodePort在service中指定」</p>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types" target="_blank" rel="external">service type文档</a></p>
<ul>
<li>内部服务之间通信，使用服务名称即可，最终转换成cluster ip</li>
</ul>
<p>「服务名称在service中设置；cluster ip 可以使用kubectl get service获取」</p>
<ul>
<li><p>service通过selector关联到对应的pod</p>
</li>
<li><p>deployment中可以设置image地址来指定镜像</p>
</li>
</ul>
<h1 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h1><ul>
<li><p>创建php镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -f  ./php/build/Dockerfile -t test-php .</div></pre></td></tr></table></figure>
</li>
<li><p>创建nginx镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd nginx/build</div><div class="line">docker build -t test-nginx .</div></pre></td></tr></table></figure>
</li>
<li><p>创建php服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl create -f lnmp/php/deployment.yaml </div><div class="line">kubectl create -f lnmp/php/serverce.yaml</div></pre></td></tr></table></figure>
</li>
<li><p>创建nginx服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl create -f lnmp/nginx/deployment.yaml</div><div class="line">kubectl create -f lnmp/nginx/serverce.yaml</div></pre></td></tr></table></figure>
</li>
<li><p>测试服务连通性</p>
</li>
</ul>
<p>获取本地ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">minikube ip</div></pre></td></tr></table></figure>
<p>编辑/etc/hosts文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">test.com minikube输出的ip值</div></pre></td></tr></table></figure>
<p>访问输出hello world</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export NODE_PORT=$(kubectl get services/test-nginx  -o go-template=&apos;&#123;&#123;(index .spec.ports 0).nodePort&#125;&#125;&apos;)</div><div class="line">echo NODE_PORT=$NODE_PORT</div><div class="line">curl test.com:$NODE_PORT</div></pre></td></tr></table></figure>
<h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><h3 id="pod启动问题"><a href="#pod启动问题" class="headerlink" title="pod启动问题"></a>pod启动问题</h3><ul>
<li>定位pod问题</li>
</ul>
<p>查看pod日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl pod &#123;pod name&#125;</div></pre></td></tr></table></figure></p>
<p>查看pod的event日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl describe pods &#123;pod-name&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>镜像拉取失败<br>登录到虚拟主机，拉取镜像进行测试</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">minikube ssh</div><div class="line">docker pull image_name</div></pre></td></tr></table></figure>
<ul>
<li>实例化镜像失败<br>登录到虚拟主机，创建容器，查看具体信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">minikube ssh</div><div class="line">docker run -itd --name=test test_nginx /bin/bash</div></pre></td></tr></table></figure>
<h3 id="外部访问不通"><a href="#外部访问不通" class="headerlink" title="外部访问不通"></a>外部访问不通</h3><ul>
<li>确认访问地址正确，上图3位置</li>
</ul>
<p>查看访问日志，确认请求达到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl exec -it &#123;pod name&#125; /bin/bash</div></pre></td></tr></table></figure>
<ul>
<li>确认service，deployment关联正确，上图2位置</li>
</ul>
<p>确认service能选择到pod<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get pod --selector=&quot;app=test-nginx&quot;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>确认nginx和php服务通信正常，上图4位置</p>
<p>  登录nginx的pod节点，ping service_name</p>
<p>  如果不通，对比ping显示的ip和php服务的service对应的cluster ip</p>
<p>  如果对应不上，重新走一遍创建整个服务流程</p>
</li>
<li><p>调试过程中，需要安装一些软件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">apt-get update</div><div class="line">apt-get install -y &#123;soft name&#125;</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h1><p>「mac+minikube」</p>
<ol>
<li>mac10.13.6</li>
<li>minikube versi]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[beego使用示例]]></title>
    <link href="http://www.cxyteam.com/2018/11/28/beego%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
    <id>http://www.cxyteam.com/2018/11/28/beego使用示例/</id>
    <published>2018-11-28T12:43:25.000Z</published>
    <updated>2018-11-28T16:25:56.036Z</updated>
    <content type="html"><![CDATA[<h1 id="安装beego框架"><a href="#安装beego框架" class="headerlink" title="安装beego框架"></a>安装beego框架</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go get github.com/astaxie/beego</div></pre></td></tr></table></figure>
<h1 id="创建项目：beego"><a href="#创建项目：beego" class="headerlink" title="创建项目：beego"></a>创建项目：beego</h1><ul>
<li>创建</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bee new beego</div></pre></td></tr></table></figure>
<ul>
<li>生成如下目录结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── conf</div><div class="line">│   └── app.conf</div><div class="line">├── controllers</div><div class="line">│   └── default.go</div><div class="line">├── main.go</div><div class="line">├── models</div><div class="line">├── routers</div><div class="line">│   └── router.go</div><div class="line">├── static</div><div class="line">│   ├── css</div><div class="line">│   ├── img</div><div class="line">│   └── js</div><div class="line">│       └── reload.min.js</div><div class="line">├── tests</div><div class="line">│   └── default_test.go</div><div class="line">└── views</div><div class="line">    └── index.tpl</div></pre></td></tr></table></figure>
<h1 id="优雅的使用beego"><a href="#优雅的使用beego" class="headerlink" title="优雅的使用beego"></a>优雅的使用beego</h1><p>注：示例代码见文末链接</p>
<ol>
<li><p>代码分层</p>
<ul>
<li><p>controller：业务流程封装层</p>
</li>
<li><p>service：业务封装层</p>
</li>
<li><p>model：数据层</p>
<ul>
<li><p>data：数据逻辑层</p>
</li>
<li><p>dao：数据操作层</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>举个例子(客服端付款方式)：购买商品分为这么几个业务逻辑：</p>
<ol>
<li><p>本地添加订单记录 </p>
</li>
<li><p>向支付中心发起支付请求 </p>
</li>
<li><p>更新本地订单状态 </p>
</li>
<li><p>下发支付参数</p>
</li>
</ol>
<p>对于三个层要做的事情分别是：</p>
<ul>
<li><p>dao层</p>
<ol>
<li><p>mysql中订单表添加操作 </p>
</li>
<li><p>mysql中订单状态更新操作 </p>
</li>
<li><p>对应缓存操作 </p>
</li>
<li><p>其他附属表及缓存的操作</p>
</li>
</ol>
</li>
<li><p>data层</p>
<ol>
<li><p>提供订单添加操作（mysql+redis） </p>
</li>
<li><p>提供订单表的状态更新操作（mysql+redis）</p>
</li>
</ol>
</li>
<li><p>servic层</p>
<ol>
<li><p>封装一个本地添加订单的逻辑（包含订单表+其他表） </p>
</li>
<li><p>封装一个请求支付成功的业务方法 </p>
</li>
<li><p>封装支付中心请求下单接口</p>
</li>
</ol>
</li>
<li><p>controller层</p>
<ol>
<li>先本地下单（service中的1方法）-&gt; 向支付中心下单 -&gt; 更新订单状态（service中2方法）</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">├── controllers</div><div class="line">│   └── order.go</div><div class="line">├── models</div><div class="line">│   ├── dao</div><div class="line">│   │   ├── mysql</div><div class="line">│   │   │   └── order.go</div><div class="line">│   │   └── redis</div><div class="line">│   │       └── order.go</div><div class="line">│   └── data</div><div class="line">│       └── order.go</div><div class="line">├── service</div><div class="line">│   └── order.go</div></pre></td></tr></table></figure>
<ol>
<li>配置文件的使用<br>注:pro定义线上配置;dev为测试配置;发布代码时定义钩子;用pro替换app</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">├── conf</div><div class="line">│   ├── app.conf</div><div class="line">│   ├── dev.conf</div><div class="line">│   └── pro.conf</div></pre></td></tr></table></figure>
<ol>
<li>使用定时脚本</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">├── tasks</div><div class="line">│   └── test.go</div></pre></td></tr></table></figure>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bee run</div></pre></td></tr></table></figure>
<h1 id="部署及发布"><a href="#部署及发布" class="headerlink" title="部署及发布"></a>部署及发布</h1><ol>
<li>编译beego</li>
</ol>
<ul>
<li>使用go build，最后会生成一个main的二进制文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go build main.go</div></pre></td></tr></table></figure>
<ul>
<li>使用beego，最后生成和项目名称相同的二进制文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">beego run</div></pre></td></tr></table></figure>
<p>注意：如果是在mac环境开发编译，在linux运行会报错，需要使用以下方式在mac编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</div></pre></td></tr></table></figure></p>
<ol>
<li>部署beego</li>
</ol>
<ul>
<li><p>go编译生产的的二进制文件</p>
</li>
<li><p>静态文件</p>
<ul>
<li>conf</li>
<li>static</li>
<li>views</li>
</ul>
</li>
<li><p>假设data是待发布目录</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cp -R main  data</div><div class="line"></div><div class="line">cp -R beego/conf data</div><div class="line"></div><div class="line">cp -R beego/static data</div><div class="line"></div><div class="line">cp -R beego/views data</div><div class="line"></div><div class="line">tar -zcvf data.tar.gz data</div><div class="line"></div><div class="line">scp data.tar.gz online:/tmp</div></pre></td></tr></table></figure>
<ol>
<li>运行go</li>
</ol>
<ul>
<li><p>后台运行</p>
<ul>
<li>go进程down掉，无法监控重启<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup ./main &amp;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用supervisor</p>
<ul>
<li>可对go进程进行监控并重启等</li>
</ul>
</li>
</ul>
<blockquote>
<p><a href="https://beego.me/docs" target="_blank" rel="external">beego文档</a></p>
<p><a href="https://github.com/SunnySmilez/Golang/tree/master/beego" target="_blank" rel="external">代码示例</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="安装beego框架"><a href="#安装beego框架" class="headerlink" title="安装beego框架"></a>安装beego框架</h1><figure class="highlight bash"><table><tr><td]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[k8s]]></title>
    <link href="http://www.cxyteam.com/2018/11/26/k8s/"/>
    <id>http://www.cxyteam.com/2018/11/26/k8s/</id>
    <published>2018-11-26T05:10:16.000Z</published>
    <updated>2018-12-09T04:00:39.647Z</updated>
    <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><pre><code>https://github.com/kubernetes/kubernetes
https://github.com/kubernetes/minikube
http://docs.kubernetes.org.cn/475.html
</code></pre><h1 id="安装minikube"><a href="#安装minikube" class="headerlink" title="安装minikube"></a>安装minikube</h1><pre><code>https://github.com/kubernetes/minikube
</code></pre><p>查看版本号    </p>
<pre><code>kubectl version
</code></pre><p>启动minikube</p>
<pre><code>minikube start
</code></pre><p>查看集群信息</p>
<pre><code>kubectl cluster-info
</code></pre><p>查看集群下的所有节点</p>
<pre><code>kubectl get nodes

错误：
    The connection to the server 192.168.99.100:8443 was refused - did you specify the right host or port?

    先启动：minikube start
</code></pre><p>创建一个节点</p>
<pre><code>kubectl run kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1 --port=8080
</code></pre><p>查看节点</p>
<pre><code>kubectl get deployments
</code></pre><p>启动应用？</p>
<pre><code>kubectl proxy
</code></pre><p>环境变量设置POD_NAME</p>
<pre><code>export POD_NAME=$(kubectl get pods -o go-template --template &apos;{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}&apos;)
echo Name of the Pod: $POD_NAME
http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME/proxy/
</code></pre><p>获取所有的pod信息</p>
<pre><code>kubectl get pods
kubectl get services
</code></pre><p>查看pod的详情信息</p>
<pre><code>kubectl describe pods
kubectl describe services
kubectl describe deployment
</code></pre><p>查看pod的日志</p>
<pre><code>kubectl logs $POD_NAME
</code></pre><p>pod中执行命令</p>
<pre><code>kubectl exec $POD_NAME env
</code></pre><p>进入pod</p>
<pre><code>kubectl exec -it $POD_NAME bash
</code></pre><p>发布对外提供服务的service</p>
<pre><code>kubectl expose deployment/kubernetes-bootcamp --type=&quot;NodePort&quot; --port 8080
查看服务详细信息        
kubectl describe services/kubernetes-bootcamp
export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&apos;{{(index .spec.ports 0).nodePort}}&apos;)
echo $NODE_PORT
curl $(minikube ip):$NODE_PORT
</code></pre><h1 id="生成pod的yaml文件"><a href="#生成pod的yaml文件" class="headerlink" title="生成pod的yaml文件"></a>生成pod的yaml文件</h1><pre><code>kubectl get pod web01 -o yaml
</code></pre><h1 id="给pod打标签"><a href="#给pod打标签" class="headerlink" title="给pod打标签"></a>给pod打标签</h1><p>通过标签，查看指定的pods</p>
<pre><code>kubectl get pods -l run=kubernetes-bootcamp
kubectl get service -l run=kubernetes-bootcamp
</code></pre><p>pod的name写入环境变量</p>
<pre><code>export POD_NAME=$(kubectl get pods -o go-template --template &apos;{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}&apos;)
echo Name of the Pod: $POD_NAME
</code></pre><p>打新标签    </p>
<pre><code>kubectl label pod $POD_NAME app=v1
</code></pre><p>查看标签是否生效</p>
<pre><code>kubectl describe pods $POD_NAME
</code></pre><p>用新标签获取信息</p>
<pre><code>kubectl get pods -l app=v1
</code></pre><p>通过标签删除service</p>
<pre><code>kubectl delete services -l  run=kubernetes-bootcamp            
</code></pre><h1 id="扩展应用程序"><a href="#扩展应用程序" class="headerlink" title="扩展应用程序"></a>扩展应用程序</h1><p>查看deployments</p>
<pre><code>kubectl get deployments
</code></pre><p>扩展4个deployment</p>
<pre><code>kubectl scale deployments/kubernetes-bootcamp --replicas=4
</code></pre><p>验证</p>
<pre><code>kubectl get deployments         
</code></pre><p>查看pod</p>
<pre><code>kubectl get pods -o wide    
</code></pre><p>查看所有的命名空间下的pods</p>
<pre><code>kubectl get pods --all-namespaces
</code></pre><p>查看deployment日志</p>
<pre><code>kubectl describe deployments/kubernetes-bootcamp
</code></pre><h1 id="Load-Balancing"><a href="#Load-Balancing" class="headerlink" title="Load Balancing"></a>Load Balancing</h1><p>查看ip信息</p>
<pre><code>kubectl describe services/kubernetes-bootcamp
</code></pre><p>端口信息写入环境变量</p>
<pre><code>export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&apos;{{(index .spec.ports 0).nodePort}}&apos;)
echo NODE_PORT=$NODE_PORT    
</code></pre><p>查看是否Load Balancing</p>
<pre><code>curl $(minikube ip):$NODE_PORT
</code></pre><h1 id="滚动更新"><a href="#滚动更新" class="headerlink" title="滚动更新"></a>滚动更新</h1><p>查看pod信息（主要看Image选项）</p>
<pre><code>kubectl describe pods    
</code></pre><p>设置image为新版本</p>
<pre><code>kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2
</code></pre><p>查看pod信息（已使用新的image）</p>
<pre><code>kubectl describe pods    
</code></pre><p>请求应用，看是否都更新完成    </p>
<pre><code>kubectl describe services/kubernetes-bootcamp
export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&apos;{{(index .spec.ports 0).nodePort}}&apos;)
echo NODE_PORT=$NODE_PORT
curl $(minikube ip):$NODE_PORT
</code></pre><p>通过命令确认</p>
<pre><code>kubectl rollout status deployments/kubernetes-bootcamp
</code></pre><h1 id="回滚更新"><a href="#回滚更新" class="headerlink" title="回滚更新"></a>回滚更新</h1><p>更新错误版本</p>
<pre><code>kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=gcr.io/google-samples/kubernetes-bootcamp:v10
</code></pre><p>查看deployments</p>
<pre><code>kubectl get deployments
</code></pre><p>查看pod状态（ErrImagePull）</p>
<pre><code>kubectl get pods
</code></pre><p>查看详情（image不对，但是还是这个images地址）</p>
<pre><code>kubectl describe pods
</code></pre><p>回滚更新</p>
<pre><code>kubectl rollout undo deployments/kubernetes-bootcamp
</code></pre><p>查看pod状态（Running）</p>
<pre><code>kubectl get pods        
</code></pre><p>查看pod版本（v2）</p>
<pre><code>kubectl describe pods
</code></pre><h1 id="deployments操作"><a href="#deployments操作" class="headerlink" title="deployments操作"></a>deployments操作</h1><p>通过文件创建deployments</p>
<pre><code>kubectl apply -f ngnix_deployment.yaml

nginx_deployment.yaml内容：

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  selector:
    matchLabels:
      app: nginx
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
        ports:
        - containerPort: 80
</code></pre><p>列出deployment创建的pod</p>
<pre><code>kubectl get pods -l app=nginx            
</code></pre><p>查出指定pod信息</p>
<pre><code>kubectl describe pod &lt;pod_name&gt;
</code></pre><p>删除deployment</p>
<pre><code>kubectl delete deployment nginx-deployment        
</code></pre><h1 id="service进行负载均衡"><a href="#service进行负载均衡" class="headerlink" title="service进行负载均衡"></a>service进行负载均衡</h1><p>创建deployments</p>
<pre><code>kubectl run hello-world --replicas=2 --labels=&quot;run=load-balancer-example&quot; --image=gcr.io/google-samples/node-hello:1.0  --port=8080
</code></pre><p>查看deployments信息</p>
<pre><code>kubectl get deployments hello-world
kubectl describe deployments hello-world
</code></pre><p>显示ReplicaSet信息</p>
<pre><code>kubectl get replicasets
kubectl describe replicasets
</code></pre><p>创建暴露deployments的service</p>
<pre><code>kubectl expose deployment hello-world --type=NodePort --name=example-service
</code></pre><p>列出运行Hello World应用程序的pod</p>
<pre><code>kubectl get pods --selector=&quot;run=load-balancer-example&quot; --output=wide
</code></pre><p>查看公网ip</p>
<pre><code>export NODE_PORT=$(kubectl get services/example-service  -o go-template=&apos;{{(index .spec.ports 0).nodePort}}&apos;)
echo NODE_PORT=$NODE_PORT
curl $(minikube ip):$NODE_PORT
</code></pre><h1 id="查看集群中所有的Container"><a href="#查看集群中所有的Container" class="headerlink" title="查看集群中所有的Container"></a>查看集群中所有的Container</h1><p>方法一</p>
<pre><code>kubectl get pods --all-namespaces -o jsonpath=&quot;{..image}&quot; |\
tr -s &apos;[[:space:]]&apos; &apos;\n&apos; |\
sort |\
uniq -c
</code></pre><p>方法二</p>
<pre><code>kubectl get pods --all-namespaces -o jsonpath=&quot;{.items[*].spec.containers[*].image}&quot;
</code></pre><p>方法三</p>
<pre><code>kubectl get pods --all-namespaces -o=jsonpath=&apos;{range .items[*]}{&quot;\n&quot;}{.metadata.name}{&quot;:\t&quot;}{range .spec.containers[*]}{.image}{&quot;, &quot;}{end}{end}&apos; |\
sort
</code></pre><p>方法五</p>
<pre><code>kubectl get pods --all-namespaces -o=jsonpath=&quot;{..image}&quot; -l app=nginx
</code></pre><p>方法六</p>
<pre><code>kubectl get pods --namespace kube-system -o jsonpath=&quot;{..image}&quot;
</code></pre><p>方法七</p>
<pre><code>kubectl get pods --all-namespaces -o go-template --template=&quot;{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}&quot;            
</code></pre><h1 id="pod启动失败"><a href="#pod启动失败" class="headerlink" title="pod启动失败"></a>pod启动失败</h1><p>查看pod详情信息</p>
<pre><code>kubectl describe pod/{name}
</code></pre><p>查看pod日志</p>
<pre><code>kubectl logs pod/{name}
</code></pre><h1 id="pod拉取镜像失败-我是使用的mac的minikube"><a href="#pod拉取镜像失败-我是使用的mac的minikube" class="headerlink" title="pod拉取镜像失败(我是使用的mac的minikube)"></a>pod拉取镜像失败(我是使用的mac的minikube)</h1><p>登录虚拟机<br>「minikube是利用virtual box启动了一个虚拟机」</p>
<pre><code>minikube ssh
</code></pre><p>拉取镜像</p>
<pre><code>docker pull {image_name}    
</code></pre><blockquote>
<p><a href="https://k8smeetup.github.io/docs/tasks/access-application-cluster/list-all-running-container-images/" target="_blank" rel="external">查看所有 namespace 中所有的 Container</a>    </p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><pre><code>https://github.com/kubernetes/kubernetes
https://github.com/ku]]>
    </summary>
    
      <category term="Other" scheme="http://www.cxyteam.com/tags/Other/"/>
    
      <category term="Other" scheme="http://www.cxyteam.com/categories/Other/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[python3+selenium寻找元素]]></title>
    <link href="http://www.cxyteam.com/2018/11/22/python3-selenium%E5%AF%BB%E6%89%BE%E5%85%83%E7%B4%A0/"/>
    <id>http://www.cxyteam.com/2018/11/22/python3-selenium寻找元素/</id>
    <published>2018-11-21T16:06:39.000Z</published>
    <updated>2018-11-22T03:22:51.849Z</updated>
    <content type="html"><![CDATA[<h1 id="打开本地文件"><a href="#打开本地文件" class="headerlink" title="打开本地文件"></a>打开本地文件</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">file_path = <span class="string">'file:///'</span>+os.path.abspath(<span class="string">"1.html"</span>)</div><div class="line">driver = webdriver.Chrome()</div><div class="line">driver.get(file_path)</div></pre></td></tr></table></figure>
<h1 id="暂停3s"><a href="#暂停3s" class="headerlink" title="暂停3s"></a>暂停3s</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">time.sleep(<span class="number">3</span>)</div></pre></td></tr></table></figure>
<h1 id="下拉框选择"><a href="#下拉框选择" class="headerlink" title="下拉框选择"></a>下拉框选择</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</div><div class="line"></div><div class="line">s=Select(driver.find_element_by_id(<span class="string">"catalogDropdown"</span>))</div><div class="line">s.find_element_by_xpath(<span class="string">"//option[@value='424636']"</span>).click()</div><div class="line">s.select_by_visible_text(<span class="string">"工作日志"</span>)</div></pre></td></tr></table></figure>
<h1 id="执行javascript脚本"><a href="#执行javascript脚本" class="headerlink" title="执行javascript脚本"></a>执行javascript脚本</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">js = <span class="string">"document.getElementsByClassName('CodeMirror-activeline')[0].innerHTML='this is test'"</span></div><div class="line">driver.execute_script(js)</div></pre></td></tr></table></figure>
<h1 id="切换iframe"><a href="#切换iframe" class="headerlink" title="切换iframe"></a>切换iframe</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">driver.switch_to.frame(driver.find_element_by_tag_name(<span class="string">"iframe"</span>))</div><div class="line">driver.find_element_by_tag_name(<span class="string">'body'</span>).send_keys(<span class="string">"hello  world！"</span>)</div></pre></td></tr></table></figure>
<h1 id="根据classname查找"><a href="#根据classname查找" class="headerlink" title="根据classname查找"></a>根据classname查找</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_class_name(<span class="string">"write-btn"</span>).click()</div></pre></td></tr></table></figure>
<h1 id="根据tagname查找"><a href="#根据tagname查找" class="headerlink" title="根据tagname查找"></a>根据tagname查找</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_tag_name(<span class="string">"input"</span>).send_keys(<span class="string">"selenium"</span>)</div></pre></td></tr></table></figure>
<h1 id="通过css方式查找"><a href="#通过css方式查找" class="headerlink" title="通过css方式查找"></a>通过css方式查找</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_css_selector(<span class="string">"#kw"</span>).send_keys(<span class="string">"selenium"</span>)</div><div class="line">driver.find_element_by_css_selector(<span class="string">"a[name='tj_news']"</span>).click()</div><div class="line">driver.find_element_by_css_selector(<span class="string">"a[title='web']"</span>).click()</div><div class="line">driver.find_element_by_css_selector(<span class="string">"a.RecycleBin"</span>).click()</div><div class="line">driver.findElement(By.cssSelector(<span class="string">"#J_login_form&gt;dl&gt;dt&gt;input[id=’ J_password’]"</span>));</div><div class="line"><span class="comment">#复合样式</span></div><div class="line"><span class="comment">#&lt;button id="J_sidebar_login" class="btn btn_big btn_submit" type="submit"&gt;登录&lt;/button&gt;</span></div><div class="line">driver.findElement(By.cssSelector(<span class="string">"button.btn.btn_big.btn_submit"</span>))</div></pre></td></tr></table></figure>
<h1 id="浏览器最大化"><a href="#浏览器最大化" class="headerlink" title="浏览器最大化"></a>浏览器最大化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">browser.maximize_window()</div></pre></td></tr></table></figure>
<h1 id="xpath查找"><a href="#xpath查找" class="headerlink" title="xpath查找"></a>xpath查找</h1><h3 id="根据class查找"><a href="#根据class查找" class="headerlink" title="根据class查找"></a>根据class查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_xpath(<span class="string">"//div[@class='user-info']/a"</span>).click()</div></pre></td></tr></table></figure>
<h3 id="根据id查找"><a href="#根据id查找" class="headerlink" title="根据id查找"></a>根据id查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_xpath(<span class="string">"//div[@id='editorTabList']/a[2]"</span>).click()</div><div class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="account_login"]/form/div/div[5]/button'</span>).click()</div></pre></td></tr></table></figure>
<h3 id="根据元素位置查找"><a href="#根据元素位置查找" class="headerlink" title="根据元素位置查找"></a>根据元素位置查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_xpath(<span class="string">'/html/body/section/div/div[2]/div[2]/div/div[2]/a[4]'</span>).click()</div></pre></td></tr></table></figure>
<h3 id="根据name查找"><a href="#根据name查找" class="headerlink" title="根据name查找"></a>根据name查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_xpath(<span class="string">'//*[@name="title"]'</span>)</div></pre></td></tr></table></figure>
<h3 id="标签文字"><a href="#标签文字" class="headerlink" title="标签文字"></a>标签文字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">driver.findElement(By.linkText(<span class="string">"About Google"</span>));</div><div class="line">driver.findElement(By.partialLinkText(<span class="string">"About"</span>));</div></pre></td></tr></table></figure>
<h1 id="层级查找元素"><a href="#层级查找元素" class="headerlink" title="层级查找元素"></a>层级查找元素</h1><h3 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在/form/span/input 层级标签下有个 div 标签的 id=fm 的元素</span></div><div class="line">driver.find_element_by_xpath(<span class="string">"//div[@id='fm']/form/span/input"</span>).send_keys(<span class="string">"s elenium"</span>)</div><div class="line"></div><div class="line"><span class="comment"># id 为'check' 的 tr ，定位它里面的第2个 td</span></div><div class="line">driver.find_element_by_xpath(<span class="string">"//tr[@id='check']/td[2]"</span>).click()</div><div class="line"></div><div class="line"><span class="comment">#第7个 tr 里面的第2个 td（position）</span></div><div class="line">driver.find_element_by_xpath(<span class="string">"//tr[7]/td[2]"</span>).click()</div><div class="line"></div><div class="line"><span class="comment">#在 a 标签下有个文本(text)包含(contains)'网页' 的元素</span></div><div class="line">driver.find_element_by_xpath(<span class="string">"//a[contains(text(),'网页')]"</span>).click()</div><div class="line"></div><div class="line"><span class="comment">#有个叫 a 的标签，他有个链接 href='http://www.baidu.com/ 的元素</span></div><div class="line">driver.find_element_by_xpath(<span class="string">"//a[@href='http://www.baidu.com/']"</span>).click()</div><div class="line"></div><div class="line">driver.findElement(By.xpath(“//img[@alt=”div1-img1”]”))</div><div class="line"></div><div class="line">driver.find_element_by_xpath(<span class="string">"//div[@name=’div2’]/input[@name=’div2input’]"</span>)</div><div class="line">driver.findElement(By.xpath(<span class="string">"//input[@type='submit'][@name='fuck']"</span>));</div><div class="line">driver.findElement(By.xpath(<span class="string">"//input[@type='submit' or @name='fuck']"</span>));</div><div class="line">driver.findElement(By.xpath(<span class="string">"//input[@type='submit' and @name='fuck']"</span>));</div><div class="line"><span class="comment">#匹配id以fuck开头的元素，id='fuckyou'</span></div><div class="line">WebElement ele = driver.findElement(By.xpath(<span class="string">"//input[start-with(@id,'fuck')]"</span>));</div><div class="line"><span class="comment">#匹配id以fuck结尾的元素，id='youfuck'</span></div><div class="line">WebElement ele = driver.findElement(By.xpath(<span class="string">"//input[ends-with(@id,'fuck')]"</span>));</div><div class="line"><span class="comment">#匹配id中含有fuck的元素，id='youfuckyou'</span></div><div class="line">WebElement ele = driver.findElement(By.xpath(<span class="string">"//input[contains(@id,'fuck')]"</span>));</div><div class="line"><span class="comment">#匹配所有input元素中含有属性的值为fuck的元素</span></div><div class="line">driver.findElement(By.xpath(<span class="string">"//input[@*='fuck']"</span>));</div></pre></td></tr></table></figure>
<h3 id="根据标签文案查找"><a href="#根据标签文案查找" class="headerlink" title="根据标签文案查找"></a>根据标签文案查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">driver.find_element_by_id(<span class="string">'xx'</span>).find_element_by_link_text(<span class="string">'Another_action'</span>)</div></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/qingchunjun/p/4208159.html" target="_blank" rel="external">https://www.cnblogs.com/qingchunjun/p/4208159.html</a><br><a href="https://www.cnblogs.com/yufeihlf/p/5689042.html" target="_blank" rel="external">https://www.cnblogs.com/yufeihlf/p/5689042.html</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="打开本地文件"><a href="#打开本地文件" class="headerlink" title="打开本地文件"></a>打开本地文件</h1><figure class="highlight python"><table><tr><td class="gu]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[go数组,切片,map]]></title>
    <link href="http://www.cxyteam.com/2018/11/09/go%E6%95%B0%E7%BB%84-%E5%88%87%E7%89%87-map/"/>
    <id>http://www.cxyteam.com/2018/11/09/go数组-切片-map/</id>
    <published>2018-11-09T06:50:33.000Z</published>
    <updated>2018-11-09T09:08:53.948Z</updated>
    <content type="html"><![CDATA[<p>在写go的时候，对数组，切片和map的概念感觉很模糊，重新把这三个数据类型进行了整理</p>
<p>在了解这三个数据类型之前，得先了解几个概念</p>
<p>值类型：所有的值类型变量是在赋值和作为参数传递时都将产生一次赋值动作</p>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><ol>
<li><p>声明</p>
</li>
<li><p>取值</p>
</li>
<li><p>遍历</p>
</li>
</ol>
<h1 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h1><ol>
<li><p>声明</p>
</li>
<li><p>取值/赋值</p>
</li>
</ol>
<h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><ol>
<li><p>声明</p>
</li>
<li><p>取值/赋值</p>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>在写go的时候，对数组，切片和map的概念感觉很模糊，重新把这三个数据类型进行了整理</p>
<p>在了解这三个数据类型之前，得先了解几个概念</p>
<p>值类型：所有的值类型变量是在赋值和作为参数传递时都将产生一次赋值动作</p>
<h1 id="数组"><a href]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[lldb调试redis]]></title>
    <link href="http://www.cxyteam.com/2018/11/06/lldb%E8%B0%83%E8%AF%95redis/"/>
    <id>http://www.cxyteam.com/2018/11/06/lldb调试redis/</id>
    <published>2018-11-05T16:00:52.000Z</published>
    <updated>2018-11-05T16:22:08.547Z</updated>
    <content type="html"><![CDATA[<p>lldb调试redis步骤</p>
<p>1、编译redis并启动redis服务<br>「目前位于redis源码目录」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make &amp;&amp; ./src/redis-server &amp;</div></pre></td></tr></table></figure>
<p>2、lldb调试redis-cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">lldb src/redis-cli</div><div class="line">(lldb) target create &quot;src/redis-cli&quot;</div><div class="line">Current executable set to &apos;src/redis-cli&apos; (x86_64).</div></pre></td></tr></table></figure>
<p>4、设置断点<br>注：「redis-cli.c文件的第986行，redis版本为：3.0.2」，第986行代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-&gt; 986	        if (line[0] != &apos;\0&apos;) &#123;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(lldb) b redis-cli.c:986</div><div class="line">Breakpoint 1: where = redis-cli`main + 11728 [inlined] repl + 74 at redis-cli.c:2288, address = 0x00000001000081b0</div></pre></td></tr></table></figure>
<p>5、运行redis-cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(lldb) process launch</div><div class="line">P</div><div class="line">Process 7181 launched: &apos;/Users/sunnysmilez/Desktop/code/redis-3.0.2/src/redis-cli&apos; (x86_64)</div><div class="line">P</div></pre></td></tr></table></figure>
<p>6、执行redis命令<br>注「使用ctrl+c进去信号处理器」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; SET KEY MS</div><div class="line">                           Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = signal SIGSTOP</div><div class="line">    frame #0: 0x00007fff52bf4142 libsystem_kernel.dylib`read + 10</div><div class="line">libsystem_kernel.dylib`read:</div><div class="line">-&gt;  0x7fff52bf4142 &lt;+10&gt;: jae    0x7fff52bf414c            ; &lt;+20&gt;</div><div class="line">    0x7fff52bf4144 &lt;+12&gt;: movq   %rax, %rdi</div><div class="line">    0x7fff52bf4147 &lt;+15&gt;: jmp    0x7fff52be9b0e            ; cerror</div><div class="line">    0x7fff52bf414c &lt;+20&gt;: retq</div><div class="line">Target 1: (redis-cli) stopped.</div></pre></td></tr></table></figure>
<p>7、使用c命令进入断点<br>注：「c也就是continue命令」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">(lldb) c</div><div class="line">Process 7181 resuming</div><div class="line"></div><div class="line">redis-cli was compiled with optimization - stepping may behave oddly; variables may not be available.</div><div class="line">Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = breakpoint 1.1</div><div class="line">    frame #0: 0x00000001000081b0 redis-cli`main [inlined] repl at redis-cli.c:986 [opt]</div><div class="line">   983</div><div class="line">   984 	    cliRefreshPrompt();</div><div class="line">   985 	    while((line = linenoise(context ? config.prompt : &quot;not connected&gt; &quot;)) != NULL) &#123;</div><div class="line">-&gt; 986 	        if (line[0] != &apos;\0&apos;) &#123;</div><div class="line">   987 	            argv = sdssplitargs(line,&amp;argc);</div><div class="line">   988 	            if (history) linenoiseHistoryAdd(line);</div><div class="line">   989 	            if (historyfile) linenoiseHistorySave(historyfile);</div><div class="line">Target 1: (redis-cli) stopped.</div></pre></td></tr></table></figure>
<p>8、使用n向下执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">(lldb) n</div><div class="line">Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = step over</div><div class="line">    frame #0: 0x00000001000081bb redis-cli`main [inlined] repl at redis-cli.c:987 [opt]</div><div class="line">   984 	    cliRefreshPrompt();</div><div class="line">   985 	    while((line = linenoise(context ? config.prompt : &quot;not connected&gt; &quot;)) != NULL) &#123;</div><div class="line">   986 	        if (line[0] != &apos;\0&apos;) &#123;</div><div class="line">-&gt; 987 	            argv = sdssplitargs(line,&amp;argc);</div><div class="line">   988 	            if (history) linenoiseHistoryAdd(line);</div><div class="line">   989 	            if (historyfile) linenoiseHistorySave(historyfile);</div><div class="line">   990</div><div class="line">Target 1: (redis-cli) stopped.</div><div class="line">(lldb) n</div><div class="line">Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = step over</div><div class="line">    frame #0: 0x00000001000081d2 redis-cli`main [inlined] repl at redis-cli.c:988 [opt]</div><div class="line">   985 	    while((line = linenoise(context ? config.prompt : &quot;not connected&gt; &quot;)) != NULL) &#123;</div><div class="line">   986 	        if (line[0] != &apos;\0&apos;) &#123;</div><div class="line">   987 	            argv = sdssplitargs(line,&amp;argc);</div><div class="line">-&gt; 988 	            if (history) linenoiseHistoryAdd(line);</div><div class="line">   989 	            if (historyfile) linenoiseHistorySave(historyfile);</div><div class="line">   990</div><div class="line">   991 	            if (argv == NULL) &#123;</div><div class="line">Target 1: (redis-cli) stopped.</div><div class="line">(lldb) n</div><div class="line">Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = step over</div><div class="line">    frame #0: 0x00000001000081df redis-cli`main [inlined] repl at redis-cli.c:989 [opt]</div><div class="line">   986 	        if (line[0] != &apos;\0&apos;) &#123;</div><div class="line">   987 	            argv = sdssplitargs(line,&amp;argc);</div><div class="line">   988 	            if (history) linenoiseHistoryAdd(line);</div><div class="line">-&gt; 989 	            if (historyfile) linenoiseHistorySave(historyfile);</div><div class="line">   990</div><div class="line">   991 	            if (argv == NULL) &#123;</div><div class="line">   992 	                printf(&quot;Invalid argument(s)\n&quot;);</div><div class="line">Target 1: (redis-cli) stopped.</div><div class="line">(lldb) n</div><div class="line">Process 7181 stopped</div><div class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = step over</div><div class="line">    frame #0: 0x00000001000081e7 redis-cli`main [inlined] repl at redis-cli.c:991 [opt]</div><div class="line">   988 	            if (history) linenoiseHistoryAdd(line);</div><div class="line">   989 	            if (historyfile) linenoiseHistorySave(historyfile);</div><div class="line">   990</div><div class="line">-&gt; 991 	            if (argv == NULL) &#123;</div><div class="line">   992 	                printf(&quot;Invalid argument(s)\n&quot;);</div><div class="line">   993 	                free(line);</div><div class="line">   994 	                continue;</div><div class="line">Target 1: (redis-cli) stopped.</div></pre></td></tr></table></figure>
<p>9、使用p打印值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(lldb) p *argv</div><div class="line">(sds) $0 = 0x0000000100203e88 &quot;SET&quot;</div><div class="line">(lldb) p *(argv+1)</div><div class="line">(sds) $1 = 0x0000000100203ed8 &quot;KEY&quot;</div><div class="line">(lldb) p *(argv+2)</div><div class="line">(sds) $2 = 0x0000000100203ee8 &quot;MS&quot;</div><div class="line">(lldb) p line</div><div class="line">(char *) $3 = 0x0000000100202ef0 &quot;SET KEY MS\n&quot;</div></pre></td></tr></table></figure>
<p>10、结束</p>
<p>使用n和p去查看你想要看到的一切值吧</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>lldb调试redis步骤</p>
<p>1、编译redis并启动redis服务<br>「目前位于redis源码目录」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div c]]>
    </summary>
    
      <category term="Redis" scheme="http://www.cxyteam.com/tags/Redis/"/>
    
      <category term="Redis" scheme="http://www.cxyteam.com/categories/Redis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[golang使用beego进行mvc]]></title>
    <link href="http://www.cxyteam.com/2018/11/01/golang%E4%BD%BF%E7%94%A8beego%E8%BF%9B%E8%A1%8Cmvc/"/>
    <id>http://www.cxyteam.com/2018/11/01/golang使用beego进行mvc/</id>
    <published>2018-11-01T05:30:09.000Z</published>
    <updated>2018-11-01T05:30:44.543Z</updated>
    <content type="html"><![CDATA[<ol>
<li>beego如何在controller引用models</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<ol>
<li>beego如何在controller引用models</li>
</ol>
]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[golang的func如何传入关联数组]]></title>
    <link href="http://www.cxyteam.com/2018/11/01/golang%E7%9A%84func%E5%A6%82%E4%BD%95%E4%BC%A0%E5%85%A5%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84/"/>
    <id>http://www.cxyteam.com/2018/11/01/golang的func如何传入关联数组/</id>
    <published>2018-11-01T05:10:03.000Z</published>
    <updated>2018-11-01T05:21:48.221Z</updated>
    <content type="html"><![CDATA[<p>最近项目中使用golang，在封装函数的时候，想到传入php的数组概念，记录一下</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	Params := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</div><div class="line">		<span class="string">"name"</span>				: <span class="string">"hello"</span>,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	demo(Params)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo</span><span class="params">(param <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	fmt.Printf(param[<span class="string">"name"</span>])</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>最近项目中使用golang，在封装函数的时候，想到传入php的数组概念，记录一下</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[golang使用net/http]]></title>
    <link href="http://www.cxyteam.com/2018/11/01/golang%E4%BD%BF%E7%94%A8net-http/"/>
    <id>http://www.cxyteam.com/2018/11/01/golang使用net-http/</id>
    <published>2018-11-01T04:54:09.000Z</published>
    <updated>2018-11-13T02:07:25.449Z</updated>
    <content type="html"><![CDATA[<p>在使用golang的net/http发送http请求的时候，碰到了不少问题，总结了http的常见使用方式</p>
<h3 id="json格式传参"><a href="#json格式传参" class="headerlink" title="json格式传参"></a>json格式传参</h3><p>优点：传参方式用json，代码简洁<br>缺点：Content-Type为application/json发送，php中获取不到post数据，只能从输入流获取；不能设置request的header信息</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</div><div class="line">	path := <span class="string">"http://test.com"</span></div><div class="line">	values := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"username"</span>:<span class="string">"username"</span>,<span class="string">"passwd"</span>:<span class="string">"passwd"</span>&#125;</div><div class="line">	jsonvalue, _ := json.Marshal(values)</div><div class="line">	resp,err := http.Post(path, <span class="string">"application/json"</span>, bytes.NewBuffer(jsonvalue))</div><div class="line">	<span class="keyword">defer</span>  resp.Body.Close()</div><div class="line"></div><div class="line">	respBody,_:=ioutil.ReadAll(resp.Body)</div><div class="line">	fmt.Println(<span class="keyword">string</span>(respBody), err)</div><div class="line">&#125;</div><div class="line"><span class="comment">//$_POST['username']获取不到；只能file_get_contents("php://input")</span></div></pre></td></tr></table></figure>
<h3 id="postform模拟表单"><a href="#postform模拟表单" class="headerlink" title="postform模拟表单"></a>postform模拟表单</h3><p>优点：php中能获取post数据，代码简洁<br>缺点：不能设置request的header信息</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"net/url"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	UserName := <span class="string">"username"</span></div><div class="line">	PassWD := <span class="string">"passwd"</span></div><div class="line"></div><div class="line">	v := url.Values&#123;&#125;</div><div class="line">	v.Set(<span class="string">"username"</span>, UserName)</div><div class="line">	v.Set(<span class="string">"password"</span>, PassWD)</div><div class="line"></div><div class="line">	resp, err := http.PostForm(<span class="string">"http://test.com"</span>, v)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">defer</span> resp.Body.Close()</div><div class="line"></div><div class="line">	content, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">	    fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(<span class="keyword">string</span>(content))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="request方式"><a href="#request方式" class="headerlink" title="request方式"></a>request方式</h3><p>优点：能设置header<br>缺点：代码稍微复杂</p>
<p>发送普通post请求示例</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	Params := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</div><div class="line">		<span class="string">"is_init"</span> 			: <span class="string">"1"</span>,</div><div class="line">		<span class="string">"name"</span>				: <span class="string">"a.mp4"</span>,</div><div class="line">		<span class="string">"size"</span>				: <span class="string">"111"</span>,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	body, _ := json.Marshal(Params)</div><div class="line"></div><div class="line">	client := &amp;http.Client&#123;&#125;<span class="comment">//客户端,被Get,Head以及Post使用</span></div><div class="line">	reqest, err := http.NewRequest(<span class="string">"POST"</span>, <span class="string">"http://test.com"</span>, bytes.NewBuffer(body))</div><div class="line">	fmt.Println(Params, body, bytes.NewBuffer(body))</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	reqest.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>) <span class="comment">//必须设定该参数,POST参数才能正常提交</span></div><div class="line"></div><div class="line">	resp, err := client.Do(reqest)<span class="comment">//发送请求</span></div><div class="line">	<span class="keyword">defer</span> resp.Body.Close()<span class="comment">//一定要关闭resp.Body</span></div><div class="line">	content, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(<span class="keyword">string</span>(content))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置request的header信息示例</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"net/url"</span></div><div class="line">	<span class="string">"strings"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</div><div class="line">	v := url.Values&#123;&#125;</div><div class="line">	v.Set(<span class="string">"name"</span>, <span class="string">"name"</span>)</div><div class="line">	v.Set(<span class="string">"is_init"</span>, <span class="string">"1"</span>)</div><div class="line"></div><div class="line">	body := ioutil.NopCloser(strings.NewReader(v.Encode()))</div><div class="line">	client := &amp;http.Client&#123;&#125;<span class="comment">//客户端,被Get,Head以及Post使用</span></div><div class="line">	reqest, err := http.NewRequest(<span class="string">"POST"</span>, <span class="string">"http://test.com"</span>, body)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	reqest.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded;param=value"</span>) <span class="comment">//必须设定该参数,POST参数才能正常提交</span></div><div class="line">    reqest.Header.Set(<span class="string">"test"</span>, <span class="string">"hello"</span>)<span class="comment">//设置header</span></div><div class="line">    </div><div class="line">	resp, err := client.Do(reqest)<span class="comment">//发送请求</span></div><div class="line">	<span class="keyword">defer</span> resp.Body.Close()<span class="comment">//一定要关闭resp.Body</span></div><div class="line">	content, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"response=&gt;"</span>, <span class="keyword">string</span>(content))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="普通上传图片"><a href="#普通上传图片" class="headerlink" title="普通上传图片"></a>普通上传图片</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"mime/multipart"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	Upload(<span class="string">"http://test.com/upload"</span>, <span class="string">"/tmp/upload.png"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span>  <span class="title">Upload</span><span class="params">(request_url, file_path <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	file, err := os.Open(file_path)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"error opening file"</span>)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">defer</span> file.Close()</div><div class="line">	<span class="comment">//创建一个模拟的form中</span></div><div class="line">	bodyBuf := &amp;bytes.Buffer&#123;&#125;</div><div class="line">	bodyWriter := multipart.NewWriter(bodyBuf)</div><div class="line"></div><div class="line">	<span class="comment">//通过$_FILE['file']获取</span></div><div class="line">	fileWriter, err := bodyWriter.CreateFormFile(<span class="string">"file"</span>, file_path)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"error writing to buffer"</span>)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//这里相当于选择了文件,将文件放到form中</span></div><div class="line">	_, err = io.Copy(fileWriter, file)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//获取上传文件的类型,multipart/form-data; boundary=...</span></div><div class="line">	contentType := bodyWriter.FormDataContentType()</div><div class="line"></div><div class="line">	<span class="comment">//这个很关键,必须这样写关闭,不能使用defer关闭,不然会导致错误</span></div><div class="line">	bodyWriter.Close()</div><div class="line"></div><div class="line">	<span class="comment">//上传的其他参数设置</span></div><div class="line">	params := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</div><div class="line">		<span class="string">"desc"</span>: <span class="string">"这里可以传入别的参数"</span>,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> key, val := <span class="keyword">range</span> params &#123;</div><div class="line">		_ = bodyWriter.WriteField(key, val)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	resp, err := http.Post(request_url, contentType, bodyBuf)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"error writing to buffer"</span>)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">defer</span> resp.Body.Close()</div><div class="line">	resp_body, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"error writing to buffer"</span>)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(<span class="keyword">string</span>(resp_body))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="上传图片，并设置header"><a href="#上传图片，并设置header" class="headerlink" title="上传图片，并设置header"></a>上传图片，并设置header</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"log"</span></div><div class="line">	<span class="string">"mime/multipart"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"path/filepath"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	Upload(<span class="string">"http://test.com/upload"</span>, <span class="string">"/tmp/upload.png"</span>, <span class="string">"this is code"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Upload</span><span class="params">(request_url, img_path, code <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	file, err := os.Open(img_path)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(err.Error())</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">defer</span> file.Close()</div><div class="line"></div><div class="line">	body := &amp;bytes.Buffer&#123;&#125;</div><div class="line">	writer := multipart.NewWriter(body)</div><div class="line">	<span class="comment">//通过$_FILE['common']获取</span></div><div class="line">	part, err := writer.CreateFormFile(<span class="string">"common"</span>, filepath.Base(img_path))</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(err.Error())</div><div class="line">	&#125;</div><div class="line">	_, err = io.Copy(part, file)</div><div class="line"></div><div class="line">	err = writer.Close()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	req, err := http.NewRequest(<span class="string">"POST"</span>, request_url, body)</div><div class="line">	req.Header.Set(<span class="string">"Content-Type"</span>, writer.FormDataContentType())</div><div class="line">	<span class="comment">//业务需要进行auth，通过$_SERVER['HTTP_AUTHORIZATION']获取</span></div><div class="line">	req.Header.Set(<span class="string">"authorization"</span>, <span class="string">"Bearer "</span>+code)</div><div class="line"></div><div class="line">	client := &amp;http.Client&#123;&#125;</div><div class="line">	resp, err := client.Do(req)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatal(err)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	content, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatal(err)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	resp.Body.Close()</div><div class="line"></div><div class="line">	fmt.Println(<span class="keyword">string</span>(content))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上是常见的几种方式，在使用过程中，可以把request的方式再封装一层，简化代码再调用<br>「注：封装的不是很好，可以按照自己的需求来」</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"net/url"</span></div><div class="line">	<span class="string">"strings"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</div><div class="line">	params := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</div><div class="line">		<span class="string">"name"</span>: <span class="string">"name"</span>,</div><div class="line">		<span class="string">"is_init"</span>:<span class="string">"1"</span>,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	headers := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</div><div class="line">		<span class="string">"Content-Type"</span> : <span class="string">"application/x-www-form-urlencoded;param=value"</span>,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	Http(<span class="string">"http://test.com"</span>, params, headers)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Http</span><span class="params">(request_url <span class="keyword">string</span>, params <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, header <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</div><div class="line">	v := url.Values&#123;&#125;</div><div class="line">	<span class="keyword">for</span> key, val := <span class="keyword">range</span> params &#123;</div><div class="line">		v.Set(key, val)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	body := ioutil.NopCloser(strings.NewReader(v.Encode()))</div><div class="line">	client := &amp;http.Client&#123;&#125;</div><div class="line">	reqest, err := http.NewRequest(<span class="string">"POST"</span>, request_url, body)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> key, val := <span class="keyword">range</span> header &#123;</div><div class="line">		reqest.Header.Set(key, val)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	resp, err := client.Do(reqest)</div><div class="line">	<span class="keyword">defer</span> resp.Body.Close()</div><div class="line">	content, err := ioutil.ReadAll(resp.Body)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Fatal error "</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(<span class="keyword">string</span>(content))</div><div class="line">	<span class="keyword">return</span> <span class="keyword">string</span>(content)</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>在使用golang的net/http发送http请求的时候，碰到了不少问题，总结了http的常见使用方式</p>
<h3 id="json格式传参"><a href="#json格式传参" class="headerlink" title="json格式传参"></a>js]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[golang执行定时脚本]]></title>
    <link href="http://www.cxyteam.com/2018/10/30/golang%E6%89%A7%E8%A1%8C%E5%AE%9A%E6%97%B6%E8%84%9A%E6%9C%AC/"/>
    <id>http://www.cxyteam.com/2018/10/30/golang执行定时脚本/</id>
    <published>2018-10-30T15:22:55.000Z</published>
    <updated>2018-11-01T05:30:28.453Z</updated>
    <content type="html"><![CDATA[<p>第一次拿golang写业务的代码，其中需要使用定时脚本<br>注:「用的beego开发」</p>
<h3 id="如何执行定时脚本"><a href="#如何执行定时脚本" class="headerlink" title="如何执行定时脚本"></a>如何执行定时脚本</h3><p>注：「项目名称为api，在api/tasks/first_task.go文件写入如下代码」</p>
<p>使用toolbox的task及robfig/cron进行定时任务编写</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> tasks</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"github.com/astaxie/beego"</span></div><div class="line">    <span class="string">"github.com/astaxie/beego/toolbox"</span></div><div class="line">    <span class="string">"github.com/robfig/cron"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">//beego/toolbox/task实现</span></div><div class="line">	first_task := toolbox.NewTask(<span class="string">"first_task"</span>, <span class="string">"* * * * * *"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</div><div class="line">        log.Printf(<span class="string">"\nNotification task ran at: %s\n"</span>, time.Now())</div><div class="line">        fmt.Print(time.Now())</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    err := first_task.Run()</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        beego.Error(err)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    toolbox.AddTask(<span class="string">"first_task"</span>, first_task)</div><div class="line">    toolbox.StartTask()</div><div class="line"></div><div class="line">    <span class="keyword">defer</span> toolbox.StopTask()</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//robfig/cron实现</span></div><div class="line">    i := <span class="number">0</span></div><div class="line">    c := cron.New()</div><div class="line">    spec := <span class="string">"* * * * * *"</span></div><div class="line">    c.AddFunc(spec, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        i++</div><div class="line">        log.Println(<span class="string">"start"</span>, i)</div><div class="line">    &#125;)</div><div class="line">    c.Start()</div><div class="line">    <span class="keyword">select</span>&#123;&#125; <span class="comment">//阻塞主线程不退出</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在main.go引入tasks<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    _ <span class="string">"api/routers"</span></div><div class="line">    <span class="string">"github.com/astaxie/beego"</span></div><div class="line">    _ <span class="string">"api/tasks"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    beego.Run()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>第一次拿golang写业务的代码，其中需要使用定时脚本<br>注:「用的beego开发」</p>
<h3 id="如何执行定时脚本"><a href="#如何执行定时脚本" class="headerlink" title="如何执行定时脚本"></a>如何执行定时脚本</]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用tcpdump排查zRangeByScore参数无效问题]]></title>
    <link href="http://www.cxyteam.com/2018/10/29/%E4%BD%BF%E7%94%A8tcpdump%E6%8E%92%E6%9F%A5zRangeByScore%E5%8F%82%E6%95%B0%E6%97%A0%E6%95%88%E9%97%AE%E9%A2%98/"/>
    <id>http://www.cxyteam.com/2018/10/29/使用tcpdump排查zRangeByScore参数无效问题/</id>
    <published>2018-10-29T15:47:12.000Z</published>
    <updated>2018-11-01T13:07:59.226Z</updated>
    <content type="html"><![CDATA[<p>在做列表数据分页的时候，是将数据存储在redis的有序集合中实现的</p>
<p>核心代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zRangeByScore($key, <span class="string">'-inf'</span>, <span class="string">'+inf'</span>, <span class="keyword">array</span>(<span class="string">'limit'</span> =&gt; <span class="keyword">array</span>($start, $size)));</div></pre></td></tr></table></figure>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在进行翻页的时候，传入start=10，size=10，没有获取到新一页的数据，而是返回有序集合所有的数据</p>
<h1 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h1><h3 id="排查命令是否写错"><a href="#排查命令是否写错" class="headerlink" title="排查命令是否写错"></a>排查命令是否写错</h3><p>注：「将start和size写成定值」</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zRangeByScore($key, <span class="string">'-inf'</span>, <span class="string">'+inf'</span>, <span class="keyword">array</span>(<span class="string">'limit'</span> =&gt; <span class="keyword">array</span>(<span class="number">10</span>, <span class="number">10</span>)));</div></pre></td></tr></table></figure>
<p>数据正常返回，排查传参问题</p>
<h3 id="打印start，size"><a href="#打印start，size" class="headerlink" title="打印start，size"></a>打印start，size</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</div><div class="line">  [<span class="string">"limit"</span>]=&gt;</div><div class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</div><div class="line">    [<span class="number">0</span>]=&gt;</div><div class="line">    string(<span class="number">2</span>) <span class="string">"10"</span></div><div class="line">    [<span class="number">1</span>]=&gt;</div><div class="line">    string(<span class="number">2</span>) <span class="string">"10"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果出乎意料，start，size传入没有问题<br>可是传入的都是page=10，size=10<br>为什么两种方式的结果会不一样，redis最终执行的是什么命令呢？</p>
<h3 id="查看redis最终执行的命令"><a href="#查看redis最终执行的命令" class="headerlink" title="查看redis最终执行的命令"></a>查看redis最终执行的命令</h3><p>在服务器用tcpdump抓取redis的网络包<br>注：「在开发服务器执行tcpdump命令；redis端口为6379」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@test01v /]# tcpdump port 6379 and tcp -X -s 0</div></pre></td></tr></table></figure>
<p>当走传参的方式的时候，最终redis执行的命令是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">02:46:46.220417 IP local_host.45816 &gt; redis_host.6379: Flags [P.], seq 38:129, ack 6, win 29200, length 91</div><div class="line">	0x0000:  4500 0083 d940 4000 4006 32a2 ac11 0005  E....@@.@.2.....</div><div class="line">	0x0010:  0a83 77f9 b2f8 1875 e8b6 5ad8 4953 9e07  ..w....u..Z.IS..</div><div class="line">	0x0020:  5018 7210 2f08 0000 2a35 0d0a 2431 330d  P.r./...*5..$13.</div><div class="line">	0x0030:  0a5a 5241 4e47 4542 5953 434f 5245 0d0a  .ZRANGEBYSCORE..</div><div class="line">	0x0040:  2432 330d 0a70 6572 6665 6374 5f63 6f6d  $23..perfect_com</div><div class="line">	0x0050:  6d65 6e74 5f69 645f 6c69 7374 0d0a 2434  ment_id_list..$4</div><div class="line">	0x0060:  0d0a 2d69 6e66 0d0a 2434 0d0a 2b69 6e66  ..-inf..$4..+inf</div><div class="line">	0x0070:  0d0a 2431 300d 0a57 4954 4853 434f 5245  ..$10..WITHSCORE</div><div class="line">	0x0080:  530d 0a                                  S..</div></pre></td></tr></table></figure>
<p>可以看出传输的redis的命令为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZRANGEBYSCORE perfect_comment_id_list -inf +inf WITHSCORES</div></pre></td></tr></table></figure>
<p>没有limit参数信息，当然会返回有序集合所有的数据</p>
<p>对比传入数据后发现：<br>定值的时候传入的是数字类型，传参的方式传入的是字符串类型</p>
<p>猜测是因为php连接redis的拓展的问题<br>当传入的start，size参数为字符串类型的时候会被过滤掉</p>
<p>为什么要这样做呢，难道是redis不支持吗<br>测试后发现redis是支持的</p>
<p>愉快的将参数做了类型转换，问题得到解决</p>
<p>最后也没忘记给phpredis提了一个issue</p>
<p>「注：phpredis的版本为3.0.0」</p>
<p>后记：在tcpdump使用的时候，也可以用来查询执行的MySQL语句<br>比如说，当我需要去熟悉一个新业务或者排查bug的时候，我会将该业务的sql语句都抓取出来<br>命令如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tcpdump -A -s 0 port 3306 and tcp &gt; ~/sql.log</div></pre></td></tr></table></figure>
<p>感兴趣的朋友可以试试</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>在做列表数据分页的时候，是将数据存储在redis的有序集合中实现的</p>
<p>核心代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1<]]>
    </summary>
    
      <category term="Redis" scheme="http://www.cxyteam.com/tags/Redis/"/>
    
      <category term="Redis" scheme="http://www.cxyteam.com/categories/Redis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[tcpdump查看redis连接过程]]></title>
    <link href="http://www.cxyteam.com/2018/10/28/tcpdump%E6%9F%A5%E7%9C%8Bredis%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B/"/>
    <id>http://www.cxyteam.com/2018/10/28/tcpdump查看redis连接过程/</id>
    <published>2018-10-28T13:06:28.000Z</published>
    <updated>2018-10-28T13:19:22.918Z</updated>
    <content type="html"><![CDATA[<p>在看tcpdump的手册的时候，突然想起tcp的三次握手，四次挥手；心血来潮，就用tcpdump抓取redis的连接过程。</p>
<p>操作如下：「redis的服务器是host_redis,端口为6379」</p>
<p>1、在redis的服务器，抓取6379及tcp的网络协议包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@test01v /]# tcpdump port 6379 and tcp -X -s 0</div></pre></td></tr></table></figure>
<p>2、在客户端使用telnet连接redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ telnet host_redis 6379</div><div class="line"></div><div class="line">    Trying host_redis...</div><div class="line"></div><div class="line">    Connected to host_redis</div><div class="line"></div><div class="line">    Escape character is &apos;^]&apos;.</div><div class="line"></div><div class="line">    ^]</div><div class="line"></div><div class="line">    telnet&gt; quit</div></pre></td></tr></table></figure>
<h3 id="tcpdump参数介绍"><a href="#tcpdump参数介绍" class="headerlink" title="tcpdump参数介绍"></a>tcpdump参数介绍</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">port</div><div class="line"></div><div class="line">    指定端口号</div><div class="line"></div><div class="line">tcp</div><div class="line"></div><div class="line">    指定协议为tcp</div><div class="line"></div><div class="line">-X</div><div class="line"></div><div class="line">    以16进制和ASCII码形式显示每个报文</div><div class="line"></div><div class="line">-s</div><div class="line"></div><div class="line">    从每个分组中读取最开始的snaplen个字节，而不是默认的68个字节</div></pre></td></tr></table></figure>
<h3 id="tcpdump输出介绍"><a href="#tcpdump输出介绍" class="headerlink" title="tcpdump输出介绍"></a>tcpdump输出介绍</h3><p>注：「本机服务器为host_local」<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">02:45:1.622225 IP host_local.55638 &gt; host_redis.6379: Flags [S], seq 1105795559, win 29200, options [mss 1460,sackOK,TS val 43986276 ecr 0,nop,wscale 7], length 0</div></pre></td></tr></table></figure></p>
<h3 id="输出信息"><a href="#输出信息" class="headerlink" title="输出信息"></a>输出信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">02:45:1.622225是时间</div><div class="line"></div><div class="line">host_local.55638 &gt; 是发送端主机和端口，符号‘ &gt;’ 表明数据的传输方向</div><div class="line"></div><div class="line">host_redis.6379接收端的主机名和端口</div><div class="line"></div><div class="line">Flags [S]TCP包中的标志信息</div><div class="line"></div><div class="line">    [S] 表示这是一个SYN请求</div><div class="line"></div><div class="line">    [S.] 表示这是一个SYN+ACK确认包: </div><div class="line">    </div><div class="line">    [.] 表示这是一个ACT确认包， (client)SYN-&gt;(server)SYN-&gt;(client)ACT 就是3次握手过程</div><div class="line">    </div><div class="line">    [P] 表示这个是一个数据推送，可以是从服务器端向客户端推送，也可以从客户端向服务器端推</div><div class="line">    </div><div class="line">    [F] 表示这是一个FIN包，是关闭连接操作，client/server都有可能发起</div><div class="line">    </div><div class="line">    [R] 表示这是一个RST包，与F包作用相同，但RST表示连接关闭时，仍然有数据未被处理。可以理解为是强制切断连接</div><div class="line"></div><div class="line">seq 1105795559 序列号</div><div class="line"></div><div class="line">win 29200 指滑动窗口的大小</div><div class="line"></div><div class="line">option </div><div class="line"></div><div class="line">length 0 指数据包的大小为0</div></pre></td></tr></table></figure>
<h3 id="tcp三次握手，四次挥手图示："><a href="#tcp三次握手，四次挥手图示：" class="headerlink" title="tcp三次握手，四次挥手图示："></a>tcp三次握手，四次挥手图示：</h3><p><img src="/img/redis/tcp.jpeg" alt="Al text" title="tcp"></p>
<h1 id="三次握手流程"><a href="#三次握手流程" class="headerlink" title="三次握手流程"></a>三次握手流程</h1><h3 id="client向server发送SYN"><a href="#client向server发送SYN" class="headerlink" title="client向server发送SYN"></a>client向server发送SYN</h3><p>注：「seq=x=2440373000」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:26.882139 IP host_local.55638 &gt; host_redis.6379: Flags [SEW], seq 2440373000, win 65535, options [mss 1366,nop,wscale 5,nop,nop,TS val 776806643 ecr 0,sackOK,eol], length 0</div></pre></td></tr></table></figure>
<h3 id="server向client发送一个SYN，ACK包"><a href="#server向client发送一个SYN，ACK包" class="headerlink" title="server向client发送一个SYN，ACK包"></a>server向client发送一个SYN，ACK包</h3><p>注：「ack=x+1=2440373001；seq=y=3103132894」<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:26.882181 IP host_redis.6379 &gt; host_local.55638: Flags [S.E], seq 3103132894, ack 2440373001, win 14480, options [mss 1460,sackOK,TS val 3145177219 ecr 776806643,nop,wscale 7], length 0</div></pre></td></tr></table></figure></p>
<h3 id="client向server响应一个ACK"><a href="#client向server响应一个ACK" class="headerlink" title="client向server响应一个ACK"></a>client向server响应一个ACK</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:26.922149 IP host_local.55638 &gt; host_redis.6379: Flags [.], ack 1, win 4104, options [nop,nop,TS val 776806681 ecr 3145177219], length 0</div></pre></td></tr></table></figure>
<h1 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h1><h3 id="client向server发送FIN结束命令"><a href="#client向server发送FIN结束命令" class="headerlink" title="client向server发送FIN结束命令"></a>client向server发送FIN结束命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:31.490726 IP host_local.55638 &gt; host_redis.6379: Flags [F.], seq 1, ack 1, win 4104, options [nop,nop,TS val 776811227 ecr 3145177219], length 0</div></pre></td></tr></table></figure>
<h3 id="server向client发送响应信息，"><a href="#server向client发送响应信息，" class="headerlink" title="server向client发送响应信息，"></a>server向client发送响应信息，</h3><p>注：表示收到client的结束信号，即将关闭连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:31.490893 IP host_redis.6379 &gt; host_local.55638: Flags [.], ack 2, win 114, options [nop,nop,TS val 3145181828 ecr 776811227], length 0</div></pre></td></tr></table></figure></p>
<h3 id="server关闭连接，并发送FIN给client"><a href="#server关闭连接，并发送FIN给client" class="headerlink" title="server关闭连接，并发送FIN给client"></a>server关闭连接，并发送FIN给client</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:31.490929 IP host_redis.6379 &gt; host_local.55638: Flags [F.], seq 1, ack 2, win 114, options [nop,nop,TS val 3145181828 ecr 776811227], length 0</div></pre></td></tr></table></figure>
<h3 id="client发送ACK给server进行确认"><a href="#client发送ACK给server进行确认" class="headerlink" title="client发送ACK给server进行确认"></a>client发送ACK给server进行确认</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">23:32:31.533767 IP host_local.55638 &gt; host_redis.6379: Flags [.], ack 2, win 4104, options [nop,nop,TS val 776811267 ecr 3145181828], length 0</div></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>在看tcpdump的手册的时候，突然想起tcp的三次握手，四次挥手；心血来潮，就用tcpdump抓取redis的连接过程。</p>
<p>操作如下：「redis的服务器是host_redis,端口为6379」</p>
<p>1、在redis的服务器，抓取6379及tcp的网]]>
    </summary>
    
      <category term="Linux" scheme="http://www.cxyteam.com/tags/Linux/"/>
    
      <category term="Linux" scheme="http://www.cxyteam.com/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[redis对象]]></title>
    <link href="http://www.cxyteam.com/2018/10/24/redis%E5%AF%B9%E8%B1%A1/"/>
    <id>http://www.cxyteam.com/2018/10/24/redis对象/</id>
    <published>2018-10-24T12:28:34.000Z</published>
    <updated>2018-10-24T13:00:17.554Z</updated>
    <content type="html"><![CDATA[<h1 id="redis对象"><a href="#redis对象" class="headerlink" title="redis对象"></a>redis对象</h1><pre><code>对象包含三部分：type，encoding，ptr
type：记录对象的类型
encoding：记录对象底层的数据结构
ptr：指向底层实现的数据结构的指针
</code></pre><p><img src="/img/redis/redis_object.png" alt="Alt text" title="redis-object"></p>
<h3 id="查看key的type类型"><a href="#查看key的type类型" class="headerlink" title="查看key的type类型"></a>查看key的type类型</h3><pre><code>type key
</code></pre><h3 id="查看key的encoding的值"><a href="#查看key的encoding的值" class="headerlink" title="查看key的encoding的值"></a>查看key的encoding的值</h3><pre><code>object encoding key
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h1 id="redis对象"><a href="#redis对象" class="headerlink" title="redis对象"></a>redis对象</h1><pre><code>对象包含三部分：type，encoding，ptr
type：记录对象的类型
enc]]>
    </summary>
    
      <category term="Redis" scheme="http://www.cxyteam.com/tags/Redis/"/>
    
      <category term="Redis" scheme="http://www.cxyteam.com/categories/Redis/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[2018年年中总结]]></title>
    <link href="http://www.cxyteam.com/2018/08/06/2018%E5%B9%B4%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/"/>
    <id>http://www.cxyteam.com/2018/08/06/2018年年中总结/</id>
    <published>2018-08-06T12:57:12.000Z</published>
    <updated>2018-08-06T12:58:29.891Z</updated>
    <content type="html"><![CDATA[<h1 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h1><h1 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h1><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1>]]></content>
    <summary type="html">
    <![CDATA[<h1 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h1><h1 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h1><h1 id]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[设置disable_functions失效]]></title>
    <link href="http://www.cxyteam.com/2018/08/01/%E8%AE%BE%E7%BD%AEdisable-functions%E5%A4%B1%E6%95%88/"/>
    <id>http://www.cxyteam.com/2018/08/01/设置disable-functions失效/</id>
    <published>2018-08-01T12:51:50.000Z</published>
    <updated>2018-08-01T13:08:28.198Z</updated>
    <content type="html"><![CDATA[<h1 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h1><pre><code>使用docker-compose搭建了一套环境，在运行larveral框架的时候，报错&quot;get_cfg_var() has been disabled for security reasons in...&quot;
</code></pre><h1 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h1><ol>
<li><p>登录php的docker容器</p>
</li>
<li><p>找到php.ini文件路径<br> php -i | grep php.ini</p>
</li>
<li><p>注释disable_functions<br> ;disable_functions = system,passthru,popen,phpinfo,proc_close,proc_open,dl,show_source,get_cfg_var</p>
</li>
<li><p>重启容器<br> docker-compose restart    </p>
</li>
<li><p>运行，依然报错</p>
</li>
<li><p>确认disable_functions选项<br> php -i| grep php.ini</p>
</li>
<li><p>php-fpm.conf的锅,果断注释<br> ;php_admin_value[disable_functions] = system,passthru,shell_exec,exec,popen,phpinfo,proc_close,proc_open,dl,show_source,get_cfg_var</p>
</li>
<li><p>完美解决</p>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h1><pre><code>使用docker-compose搭建了一套环境，在运行larveral框架的时候，报错&quot;get_cfg_var()]]>
    </summary>
    
      <category term="PHP" scheme="http://www.cxyteam.com/tags/PHP/"/>
    
      <category term="PHP" scheme="http://www.cxyteam.com/categories/PHP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[git查看某人的提交文件列表]]></title>
    <link href="http://www.cxyteam.com/2018/07/31/git%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%BA%BA%E7%9A%84%E6%8F%90%E4%BA%A4%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8/"/>
    <id>http://www.cxyteam.com/2018/07/31/git查看某人的提交文件列表/</id>
    <published>2018-07-31T11:13:30.000Z</published>
    <updated>2018-07-31T11:19:30.458Z</updated>
    <content type="html"><![CDATA[<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><pre><code>想查看很久以前的某一次提交所改动的文件列表
</code></pre><h1 id="查看某人所有的提交"><a href="#查看某人所有的提交" class="headerlink" title="查看某人所有的提交"></a>查看某人所有的提交</h1><pre><code>git log --author=sunnysmilez
</code></pre><h1 id="查看某次提交的文件列表"><a href="#查看某次提交的文件列表" class="headerlink" title="查看某次提交的文件列表"></a>查看某次提交的文件列表</h1><pre><code>git whatchanged | grep -A 10  commitid(这里为上一个步骤查出来的commitid)
</code></pre><h1 id="查看某次提交具体改的内容"><a href="#查看某次提交具体改的内容" class="headerlink" title="查看某次提交具体改的内容"></a>查看某次提交具体改的内容</h1><pre><code>git show commitid
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><pre><code>想查看很久以前的某一次提交所改动的文件列表
</code></pre><h1 id="查看某人所有的提交">]]>
    </summary>
    
      <category term="GIT" scheme="http://www.cxyteam.com/tags/GIT/"/>
    
      <category term="GIT" scheme="http://www.cxyteam.com/categories/GIT/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何阅读一本书]]></title>
    <link href="http://www.cxyteam.com/2018/07/10/%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E4%B8%80%E6%9C%AC%E4%B9%A6/"/>
    <id>http://www.cxyteam.com/2018/07/10/如何阅读一本书/</id>
    <published>2018-07-09T17:22:30.000Z</published>
    <updated>2018-07-09T17:31:02.000Z</updated>
    <content type="html"><![CDATA[<h1 id="《如何阅读一本书》"><a href="#《如何阅读一本书》" class="headerlink" title="《如何阅读一本书》"></a>《如何阅读一本书》</h1><pre><code>再次读起这本书的时候，依然觉得自己欠缺很多，决定书中的步骤给记录下来，下次读书的时候，按照步骤来进行练习
</code></pre><h1 id="检视阅读"><a href="#检视阅读" class="headerlink" title="检视阅读"></a>检视阅读</h1><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>阅读书名页，在看序</li>
<li>研究目录页</li>
<li>书中索引</li>
<li>出版者介绍</li>
<li>挑几个和主题相关的章节看看</li>
<li>随意翻翻</li>
</ol>
<h3 id="注意的点"><a href="#注意的点" class="headerlink" title="注意的点"></a>注意的点</h3><ol>
<li>在阅读的时候别陷入细节，尽量做到完整的读完</li>
<li>抓住主旨，不必每个字都细看</li>
</ol>
<h3 id="阅读时需要找的问题答案"><a href="#阅读时需要找的问题答案" class="headerlink" title="阅读时需要找的问题答案"></a>阅读时需要找的问题答案</h3><ol>
<li>这是一本怎样的书</li>
<li>这本书都说了什么</li>
<li>作者借着怎样的整体架构来发展他的观点和陈序他的理解</li>
<li>这本书说的有道理吗</li>
<li>这本书和我有什么关系</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="《如何阅读一本书》"><a href="#《如何阅读一本书》" class="headerlink" title="《如何阅读一本书》"></a>《如何阅读一本书》</h1><pre><code>再次读起这本书的时候，依然觉得自己欠缺很多，决定书中的步骤给记录下来]]>
    </summary>
    
      <category term="Other" scheme="http://www.cxyteam.com/tags/Other/"/>
    
      <category term="Other" scheme="http://www.cxyteam.com/categories/Other/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[docker部署mysql的疑问]]></title>
    <link href="http://www.cxyteam.com/2018/07/02/docker%E9%83%A8%E7%BD%B2mysql%E7%9A%84%E7%96%91%E9%97%AE/"/>
    <id>http://www.cxyteam.com/2018/07/02/docker部署mysql的疑问/</id>
    <published>2018-07-02T12:52:34.000Z</published>
    <updated>2018-07-02T17:34:36.000Z</updated>
    <content type="html"><![CDATA[<h1 id="mysql的初始密码是什么"><a href="#mysql的初始密码是什么" class="headerlink" title="mysql的初始密码是什么"></a>mysql的初始密码是什么</h1><pre><code>设置环境变量：MYSQL_ROOT_PASSWORD
eg:
   docker run --name=mysql  -e MYSQL_ROOT_PASSWORD=123123 -e MYSQL_DATABASE=test1 -p 3307:3306 -d mysql_image_name
   注释：
     --name 指定容器名称
     -e 设置环境变量
        MYSQL_ROOT_PASSWORD   设置root的初始密码
        MYSQL_USER，MYSQL_PASSWORD  设置新用户及密码
        MYSQL_DATABASE 指定镜像启动容器时创建的数据库
     -p 设置端口映射，将宿主机端口3307映射到容器端口3306
     -d 后台运行
     mysql_image_name  镜像的名称
</code></pre><h1 id="mysql的数据会不会因为docker重启就消失了"><a href="#mysql的数据会不会因为docker重启就消失了" class="headerlink" title="mysql的数据会不会因为docker重启就消失了"></a>mysql的数据会不会因为docker重启就消失了</h1><pre><code>进行数据卷的挂载
eg:
    docker run --namee=mysql -e MYSQL_ROOT_PASSWORD=123123 -p 3307:3306 -v /data/mysql:/var/lib/mysql -d mysql_image_name
    注释：
        -v 设置挂载卷 将宿主机的/data/mysql挂载到容器的/var/lib/mysql
        这样重启的时候数据不会丢失，因为在宿主机上
</code></pre><h1 id="如何初始mysql数据"><a href="#如何初始mysql数据" class="headerlink" title="如何初始mysql数据"></a>如何初始mysql数据</h1><pre><code>将sql文件复制到mysql容器
    docker cp a.sql mysql_docker:/tmp

登录mysql容器
    docker exec -it mysql_docker /bin/bash

进入mysql    
    mysql -uroot -p

选择库，导入sql文件
    use database_name;
    source /tmp/a.sql
</code></pre><h1 id="乱码问题解决"><a href="#乱码问题解决" class="headerlink" title="乱码问题解决"></a>乱码问题解决</h1><pre><code>挂载my.cnf
mysql的配置文件在：/var/lib/mysql/my.cnf
eg：
    docker run -d --name=mysql -e MYSQL_ROOT_PASSWORD=123123 -e MYSQL_DATABASE=test1 -p 3308:3306 -v /data/htdocs/mysql/data:/var/lib/mysql -v /data/htdocs/mysql/conf/my.cnf:/var/lib/mysql/my.cnf eromero/mysql5.1.73

my.cnf 内容如下：    
    # Example MySQL config file for medium systems.
    #
    # This is for a system with little memory (32M - 64M) where MySQL plays
    # an important part, or systems up to 128M where MySQL is used together with
    # other programs (such as a web server)
    #
    # MySQL programs look for option files in a set of
    # locations which depend on the deployment platform.
    # You can copy this option file to one of those
    # locations. For information about these locations, see:
    # http://dev.mysql.com/doc/mysql/en/option-files.html
    #
    # In this file, you can use all long options that a program supports.
    # If you want to know which options a program supports, run the program
    # with the &quot;--help&quot; option.
    # The following options will be passed to all MySQL clients
    [client]
    default-character-set=utf8
    #password = your_password
    port = 3306
    socket = /tmp/mysql.sock
    # Here follows entries for some specific programs
    # The MySQL server
    [mysqld]
    character-set-server=utf8
    init_connect=&apos;SET NAMES utf8&apos;
    port = 3306
    socket = /tmp/mysql.sock
    skip-external-locking
    key_buffer_size = 16M
    max_allowed_packet = 1M
    table_open_cache = 64
    sort_buffer_size = 512K
    net_buffer_length = 8K
    read_buffer_size = 256K
    read_rnd_buffer_size = 512K
    myisam_sort_buffer_size = 8M
    character-set-server=utf8
    secure_file_priv=&apos;&apos;
    init_connect=&apos;SET NAMES utf8&apos;
    # Don&apos;t listen on a TCP/IP port at all. This can be a security enhancement,
    # if all processes that need to connect to mysqld run on the same host.
    # All interaction with mysqld must be made via Unix sockets or named pipes.
    # Note that using this option without enabling named pipes on Windows
    # (via the &quot;enable-named-pipe&quot; option) will render mysqld useless!
    #
    #skip-networking

    # Replication Master Server (default)
    # binary logging is required for replication
    log-bin=mysql-bin

    # binary logging format - mixed recommended
    binlog_format=mixed

    # required unique id between 1 and 2^32 - 1
    # defaults to 1 if master-host is not set
    # but will not function as a master if omitted
    server-id = 1    
    # Replication Slave (comment out master section to use this)
    #
    # To configure this host as a replication slave, you can choose between
    # two methods :
    #
    # 1) Use the CHANGE MASTER TO command (fully described in our manual) -
    # the syntax is:
    #
    # CHANGE MASTER TO MASTER_HOST=&lt;host&gt;, MASTER_PORT=&lt;port&gt;,
    # MASTER_USER=&lt;user&gt;, MASTER_PASSWORD=&lt;password&gt; ;
    #
    # where you replace &lt;host&gt;, &lt;user&gt;, &lt;password&gt; by quoted strings and
    # &lt;port&gt; by the master&apos;s port number (3306 by default).
    #
    # Example:
    #
    # CHANGE MASTER TO MASTER_HOST=&apos;125.564.12.1&apos;, MASTER_PORT=3306,
    # MASTER_USER=&apos;joe&apos;, MASTER_PASSWORD=&apos;secret&apos;;
    #
    # OR
    #
    # 2) Set the variables below. However, in case you choose this method, then
    # start replication for the first time (even unsuccessfully, for example
    # if you mistyped the password in master-password and the slave fails to
    # connect), the slave will create a master.info file, and any later
    # change in this file to the variables&apos; values below will be ignored and
    # overridden by the content of the master.info file, unless you shutdown
    # the slave server, delete master.info and restart the slaver server.
    # For that reason, you may want to leave the lines below untouched
    # (commented) and instead use CHANGE MASTER TO (see above)
    #
    # required unique id between 2 and 2^32 - 1
    # (and different from the master)
    # defaults to 2 if master-host is set
    # but will not function as a slave if omitted
    #server-id = 2
    #
    # The replication master for this slave - required
    #master-host = &lt;hostname&gt;
    #
    # The username the slave will use for authentication when connecting
    # to the master - required
    #master-user = &lt;username&gt;
    #
    # The password the slave will authenticate with when connecting to
    # the master - required
    #master-password = &lt;password&gt;
    #
    # The port the master is listening on.
    # optional - defaults to 3306
    #master-port = &lt;port&gt;
    #
    # binary logging - not required for slaves, but recommended
    #log-bin=mysql-bin

    # Uncomment the following if you are using InnoDB tables
    #innodb_data_home_dir = /usr/local/mysql/data
    #innodb_data_file_path = ibdata1:10M:autoextend
    #innodb_log_group_home_dir = /usr/local/mysql/data
    # You can set .._buffer_pool_size up to 50 - 80 %
    # of RAM but beware of setting memory usage too high
    #innodb_buffer_pool_size = 16M
    #innodb_additional_mem_pool_size = 2M
    # Set .._log_file_size to 25 % of buffer pool size
    #innodb_log_file_size = 5M
    #innodb_log_buffer_size = 8M
    #innodb_flush_log_at_trx_commit = 1
    #innodb_lock_wait_timeout = 50

    [mysqldump]
    quick
    max_allowed_packet = 16M

    [mysql]
    no-auto-rehash
    # Remove the next comment character if you are not familiar with SQL
    #safe-updates
    default-character-set=utf8

    [myisamchk]
    key_buffer_size = 20M
    sort_buffer_size = 20M
    read_buffer = 2M
    write_buffer = 2M

    [mysqlhotcopy]
    interactive-timeout
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h1 id="mysql的初始密码是什么"><a href="#mysql的初始密码是什么" class="headerlink" title="mysql的初始密码是什么"></a>mysql的初始密码是什么</h1><pre><code>设置环境变量：MYSQL_ROOT_]]>
    </summary>
    
      <category term="Docker" scheme="http://www.cxyteam.com/tags/Docker/"/>
    
      <category term="Docker" scheme="http://www.cxyteam.com/categories/Docker/"/>
    
  </entry>
  
</feed>